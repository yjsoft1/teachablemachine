<div class="modal-container">
  <div class="modal-window">
    <div class="modal-content" style="max-width:1000px">
      <!--페이지 타이틀-->
      <div class="dialog-title1" style="max-width:1000px">
        <ul>
          <li>
              <h5 id="dialog-title1-userscanvas">담당자 정보</h5>
          </li>
          <li style="float:right">
              <img id="dialog-close-id_remove_userscanvas" class="dialog-close" src="/images/close2.png" />
          </li>
        </ul>
      </div>

      <div class="margin_33px"></div>
        
      <div style="width:100%;text-align: center">
          <div id="loading_spinner_userscanvas" style="background:rgb(255, 255, 255)"></div>
      </div>  
      
      <div class="margin_10px"></div>
      <div class="margin_10px"></div>

      <div class="stretch_wrap" style="height:36px;width:95%;margin:auto;">
          <div class="stretch_left_100percent" style="right:200px;">
              <div id="dialog-title2-userscanvas" class="dialog-title2" style="display: inline-block;">팝업창을 터치하시면 이전의 화면으로 되돌아 갑니다.</div>
          </div>
          <div class="stretch_right_100px" style="text-align: right;max-width:150px;height:35px;cursor:pointer; ">
              <div id="dialog_write_check_user_work" style="display: inline-block;">
                  <img style="opacity:0.8;height: 35px" src="/images/button1_work.png"
                       onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'; this.style.transform='scale(1)'"
                       onmousedown="this.style.transform='scale(0.95)'" onmouseup="this.style.transform='scale(1)' ">
                  <h4 style="text-align: center;">
                      근무중
                  </h4>
              </div>
              <div id="dialog_write_check_user_work_ofout" style="display: inline-block;">
                  <img style="opacity:0.8;height: 35px" src="/images/button1_work_outof.png"
                       onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'; this.style.transform='scale(1)'"
                       onmousedown="this.style.transform='scale(0.95)'" onmouseup="this.style.transform='scale(1)' ">
                  <h4 style="text-align: center;">
                      부재중
                  </h4>
              </div>
              <div id="dialog_write_check_user_wrap" style="display:none;">
                  <img class="edit_userinfo" style="opacity:0.8;height: 35px;" src="/images/button1_edit.png"
                       onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'; this.style.transform='scale(1)'"
                       onmousedown="this.style.transform='scale(0.95)'" onmouseup="this.style.transform='scale(1)' ">
                  <h4 style="text-align: center;">
                      편집
                  </h4>
              </div>
          </div>
      </div>

      <div class="margin_33px"></div>
      <!-- <div id="dialog-title2-userscanvas" class="dialog-title2" style="text-indent: 10px;display: inline-block;">팝업창을 터치하시면 이전의 화면으로 되돌아 갑니다.</div>
      <div style="max-width:36px;background-size: 40px 40px;display: inline-block;margin-right: 2.5%;">
          <img class="edit_userinfo" style="cursor:pointer" src="/images/button1_edit.png" />
      </div> -->
      
      <!-- 담당자 정보 -->
      <div class="stretch_wrap table-background-height-enduser" style="width: 95%;max-width:1000px;margin: 0 auto;"> 
        <div id="dialog_write_user_id_wrap" class="stretch_left_100percent" style="right:630px;overflow: hidden;">
          <div class="stretch_left_100percent" style="right:15px;margin-right:0px;border: 10px solid #f1f1f1;border-radius:10px;background-color:#f1f1f1;z-index:1;overflow: hidden;">
            <img class="userimage_main" src="/images/user_sample.png" style="width:100%;height:auto;display: block;margin-left: auto;margin-right: auto;"/>
          </div>                     
        </div>
        <!-- <div id="dialog_write_check_user_wrap" class="stretch_right_100px" style="max-width:630px;"> -->
        <div class="stretch_right_100px" style="max-width:630px;">
          <table cellspacing="0" cellpadding="0" class="table_layout" >
            <colgroup>
              <col width="25%" style="min-width:100px">
              <col width="75%">
            </colgroup>
            
            <tbody>
            <tr>
            </tr>
            <tr class="font-size-enduser">
              <th>이름</th>
              <td><input id="dialog_write_name" type="text" class="inputbox1 font-size-enduser table-row-height-enduser" maxlength="30" style="border-width: 0;" readonly></td>
            </tr>
            <tr class="font-size-enduser">
              <th>직급</th>
              <td>
                <!-- <input id="dialog_write_position" type="text" class="inputbox1" maxlength="50" style="border-width: 0;" readonly> -->
                <select id="dialog_write_position" class="select1 dialog_write_position_arrow font-size-enduser table-row-height-enduser" style="border-width:0;text-indent:5px;background:white" >
                </select>
              </td>
            </tr>
            <tr class="font-size-enduser">
              <th>담당업무</th>
              <td><input id="dialog_write_mobile" type="text" class="inputbox1 font-size-enduser table-row-height-enduser" maxlength="30" style="border-width: 0;" readonly></td>
            </tr>
            <tr class="font-size-enduser">
              <th rowspan="3">연락처</th>
              <td><input id="dialog_write_task_1" type="text" class="inputbox1 font-size-enduser table-row-height-enduser" maxlength="30" style="border-width: 0;" readonly></td>
            </tr>
            <tr class="font-size-enduser">
              <!-- <th>등록일자</th> -->
              <td><input id="dialog_write_task_2" type="text" class="inputbox1 font-size-enduser table-row-height-enduser" maxlength="30" style="border-width: 0;" readonly></td>
            </tr>
            <tr class="font-size-enduser">
              <!-- <th>최종수정일자</th> -->
              <td><input id="dialog_write_task_3" type="text" class="inputbox1 font-size-enduser table-row-height-enduser" maxlength="30" style="border-width: 0;" readonly></td>
            </tr>
            <tr style="display: none;" class="font-size-enduser">
              <!-- <th>최종수정일자</th> -->
              <td><input id="dialog_write_task_4" type="text" class="inputbox1 font-size-enduser table-row-height-enduser" maxlength="30" style="border-width: 0;" readonly></td>
            </tr>

            <tr class="userscanvas_setimage font-size-enduser" style="display:none;">
              <th>이미지</th>
              <td>
                <div class="stretch_wrap table-row-height-enduser" >
                  <div class="stretch_left_100percent" style="right:50px;margin-right: 3px">
                    <input id="print_selected_imagename" type="text" class="inputbox1 font-size-enduser table-row-height-enduser" >
                  </div>                  
                  <div class="stretch_right_100px file_find touch_no_highlight_color" style="max-width:50px;">
                    <input id="dialog_write_image" type="file" class="font-size-enduser table-row-height-enduser"/>
                  </div>
                </div>
              </td>
            </tr>
            

            <tr class="userscanvas_settype font-size-enduser table-row-height-enduser" style="display:none;">
              <th>타입</th>
              <td>
                <select id="dialog_write_type" class="select1 font-size-enduser table-row-height-enduser" style="border-width: 0;text-indent: 5px;background:white" >
                  <option value="type1">type1</option>
                  <option value="type1_1">type1_1</option>
                  <option value="type2">type2</option>
                  <option value="type3">type3</option>
                  <option value="type4">type4</option>
                  <option value="type5">type5</option>
                  <option value="type6">type6</option>
                  <option value="type_range1">type_range1</option>
                </select>
              </td>
            </tr>

            <tr class="userscanvas_setscale font-size-enduser" style="display:none;">
              <th>크기</th>
              <td>
                <select id="dialog_write_scale" class="select1 font-size-enduser table-row-height-enduser" style="border-width: 0;text-indent: 5px;background:white" >
                    <option value="0.4">0.4</option>
                    <option value="0.5">0.5</option>
                    <option value="0.6">0.6</option>
                    <option value="0.7">0.7</option>
                    <option value="0.8">0.8</option>
                    <option value="0.9">0.9</option>
                    <option value="1">1</option>
                    <option value="1.1">1.1</option>
                    <option value="1.2">1.2</option>
                    <option value="1.3">1.3</option>
                    <option value="1.4">1.4</option>
                    <option value="1.5">1.5</option>
                    <option value="1.6">1.6</option>
                    <option value="1.7">1.7</option>
                    <option value="1.8">1.8</option>
                    <option value="1.9">1.9</option>
                    <option value="2">2</option> 
                </select>
              </td>
            </tr>

          </tbody></table>
        </div>
      </div>





      <div id="dialog-title2-userscanvas_hidden_status" class="dialog-title2" style="display:none">hidden_message</div>
      <!-- <div id="dialog-title2-userscanvas-selectedvalue" ></div> -->        
      
      <div id="container_userscanvas" class="layout_max1000" style="margin-top:0px">
        <!--content//-->
        <div id="content_userscanvas">
          <div class="dialog-buttons">
            <button id="btnSave_userscanvas" class="button">확인</button>
            <button id="btnCancel_userscanvas" class="button" >취소</button>
            <button id="btnRemove_userscanvas" class="button" style="display:none" >삭제</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  


<script>
    
  //scroll off
  scroll_body_on_off(false);
    
  //관리자 메뉴 표시
  var getUserInfo = parseJwt(sessionStorage.getItem(token_yj_rfms));
  if (getUserInfo != null) {
    if ((getUserInfo.mb_auth == "관리자") || (getUserInfo.mb_auth == "시스템관리자")) {
        document.getElementById('dialog_write_check_user_wrap').style.display = "inline-block";
    }
  }    

  init_input();

  function init_input() {
    document.getElementById('dialog_write_name').value = "";
    document.getElementById('dialog_write_position').value = "";
    document.getElementById('dialog_write_mobile').value = "";
    document.getElementById('dialog_write_task_1').value = "";
    document.getElementById('dialog_write_task_2').value = "";
    document.getElementById('dialog_write_task_3').value = "";
    document.getElementById('dialog_write_task_4').value = "";
    document.getElementById('dialog_write_type').value = "";
    document.getElementById('dialog_write_scale').value = "";
  }

  function set_gui_admin(isNew) {
    var border_width = "0px";
    var inputbox_readonly = false;
    var display_input_image = "none";
    var display_settype = "none";
    var margin_container_userscanvas = "0px";
    var vislble_btnSave_userscanvas = "none";
    var vislble_btnRemove_userscanvas = "none";
    var text_btnCancel_userscanvas = "확인";
    var select_ononff = "none";

    if (document.getElementById('dialog_write_name').style.borderWidth != "1px") {
      border_width = "1px";
      inputbox_readonly = false;
      display_input_image = "contents";
      display_settype = ""
      margin_container_userscanvas = "188px";
      vislble_btnSave_userscanvas = "inline-block";
      vislble_btnRemove_userscanvas = "inline-block";
      text_btnCancel_userscanvas = "취소";
      select_ononff = "auto";
    } else {
      border_width = "0px";
      inputbox_readonly = true;
      display_input_image = "none";
      display_settype = "none";
      margin_container_userscanvas = "0px";
      vislble_btnSave_userscanvas = "none";
      vislble_btnRemove_userscanvas = "none";
      text_btnCancel_userscanvas = "확인";
      select_ononff = "none";
    }

    if (isNew) {
      border_width = "0px";
      inputbox_readonly = true;
      display_input_image = "none";
      display_settype = "none";
      margin_container_userscanvas = "0px";
      vislble_btnSave_userscanvas = "none";
      vislble_btnRemove_userscanvas = "none";
      text_btnCancel_userscanvas = "확인";
      select_ononff = "none";
    }

    document.getElementById('dialog_write_name').style.borderWidth = border_width;
    document.getElementById('dialog_write_position').style.borderWidth = border_width;
    document.getElementById('dialog_write_mobile').style.borderWidth = border_width;
    document.getElementById('dialog_write_task_1').style.borderWidth = border_width;
    document.getElementById('dialog_write_task_2').style.borderWidth = border_width;
    document.getElementById('dialog_write_task_3').style.borderWidth = border_width;
    document.getElementById('dialog_write_task_4').style.borderWidth = border_width;
    document.getElementById('dialog_write_type').style.borderWidth = border_width;
    document.getElementById('dialog_write_scale').style.borderWidth = border_width;

    document.getElementById('dialog_write_name').readOnly = inputbox_readonly;
    document.getElementById('dialog_write_position').readOnly = inputbox_readonly;
    document.getElementById('dialog_write_mobile').readOnly = inputbox_readonly;
    document.getElementById('dialog_write_task_1').readOnly = inputbox_readonly;
    document.getElementById('dialog_write_task_2').readOnly = inputbox_readonly;
    document.getElementById('dialog_write_task_3').readOnly = inputbox_readonly;
    document.getElementById('dialog_write_task_4').readOnly = inputbox_readonly;
    document.getElementById('dialog_write_type').readOnly = inputbox_readonly;
    document.getElementById('dialog_write_scale').readOnly = inputbox_readonly;
         
    document.getElementById('container_userscanvas').style.marginTop = margin_container_userscanvas;

    document.getElementsByClassName('userscanvas_setimage')[0].style.display = display_settype;
    document.getElementsByClassName('userscanvas_settype')[0].style.display = display_settype;
    document.getElementsByClassName('userscanvas_setscale')[0].style.display = display_settype;
    
    document.getElementById('btnSave_userscanvas').style.display = vislble_btnSave_userscanvas;
    document.getElementById('btnCancel_userscanvas').textContent = text_btnCancel_userscanvas;
    document.getElementById('btnRemove_userscanvas').style.display = vislble_btnRemove_userscanvas;

    //select element 클릭 되게 
    $('#dialog_write_position').css('pointer-events', select_ononff);
    if (select_ononff == "none") {
      document.getElementById('dialog_write_position').classList.add("dialog_write_position_arrow");
    } else {
      document.getElementById('dialog_write_position').classList.remove("dialog_write_position_arrow");
    }
  }


    // function checkPassword_user_workstate(input_text1, isWork) {
    //     document.getElementById("dialog_messagebox_inputbox1").value = "";
    //     dialog_messagebox_inputbox1_frame.style.display = "block";
    //     messagebox_show(true, "근무정보 변경", input_text1, function (e) {
    //         if (e == "ok") {
    //             var getPassword = document.getElementById("dialog_messagebox_inputbox1").value;
    //             if (getPassword == "1234") {
    //                 if (isWork == true) {     //근무중            
    //                     $("#dialog_write_user_id_wrap .stretch_left_100percent").css("border-color", "#f1f1f1");
    //                 } else {                  //부재중
    //                     $("#dialog_write_user_id_wrap .stretch_left_100percent").css("border-color", "#ff6600");
    //                 }

    //                 //db에 저장
    //                 send_userinfo(false);

    //                 //사용자의 근무중, 부재중의 테두리를 변경
    //                 setCanvasUserState(isWork);
    //                 //메시지 박스의 텍스트 박스를(input) 안보이게 함
    //                 dialog_messagebox_inputbox1_frame.style.display = "none";
    //             }
    //         }
    //     }, false, true);
    // }

    function checkPassword_user_workstate(isWork) {
        if (isWork == true) {     //근무중            
            $("#dialog_write_user_id_wrap .stretch_left_100percent").css("border-color", "#f1f1f1");
        } else {                  //부재중
            $("#dialog_write_user_id_wrap .stretch_left_100percent").css("border-color", "#ff6600");
        }

        //db에 저장
        send_userinfo(false);

        //사용자의 근무중, 부재중의 테두리를 변경
        setCanvasUserState(isWork);
    }
    
    //사용자의 근무중, 부재중의 테두리를 변경
    function setCanvasUserState(isWork) {
        var canvas_main = document.getElementById('userscanvas_main');
        var get_elements = canvas_main.getElementsByClassName("user_info_canvas_label_text_no")

        for (var i = 0; i < get_elements.length; i++) {
            if (parseInt(get_elements[i].textContent) == parseInt(get_selected_no)) {
                var userImageBorder_element = get_elements[i].parentElement.parentElement.getElementsByClassName("user_info_template_content_1")[0];
                if (isWork == true) {
                    userImageBorder_element.style.backgroundColor = "#f1f1f1";
                } else {
                    userImageBorder_element.style.backgroundColor = "#ff6600";
                }
            }
        }
    }

    document.getElementById('dialog_write_check_user_work').addEventListener('click', function () {
        checkPassword_user_workstate(true);
    });
    document.getElementById('dialog_write_check_user_work').addEventListener('touchstart', function () {
        checkPassword_user_workstate(true);
    });
    
    document.getElementById('dialog_write_check_user_work_ofout').addEventListener('click', function () {
        checkPassword_user_workstate(false);
    });
    document.getElementById('dialog_write_check_user_work_ofout').addEventListener('touchstart', function () {
        checkPassword_user_workstate(false);
    });

    // document.getElementById('dialog_write_check_user_work').addEventListener('click', function () {
    //     checkPassword_user_workstate("근무정보를 근무중으로 변경합니다. 비밀번호를 입력하여 주시기 바랍니다.", true);
    // });
    // document.getElementById('dialog_write_check_user_work').addEventListener('touchstart', function () {
    //     checkPassword_user_workstate("근무정보를 근무중으로 변경합니다. 비밀번호를 입력하여 주시기 바랍니다.", true);
    // });
    
    // document.getElementById('dialog_write_check_user_work_ofout').addEventListener('click', function () {
    //     checkPassword_user_workstate("근무정보를 부재중으로 변경합니다. 비밀번호를 입력하여 주시기 바랍니다.", false);
    // });
    // document.getElementById('dialog_write_check_user_work_ofout').addEventListener('touchstart', function () {
    //     checkPassword_user_workstate("근무정보를 부재중으로 변경합니다. 비밀번호를 입력하여 주시기 바랍니다.", false);
    // });


  document.getElementById('dialog_write_check_user_wrap').addEventListener('click', function() {
    set_gui_admin(false);
  });
  document.getElementById('dialog_write_check_user_wrap').addEventListener('touchstart', function() {
    set_gui_admin(false);
  });


  ///////////////////////////////////////////////////////////////////////
  //이미지 뷰어
    imageViewer_init();

  //이미지 추가 이벤트
  document.getElementById('dialog_write_image').addEventListener('click', function() {
    this.value = null;      
  }, false);
  document.getElementById('dialog_write_image').addEventListener('change', function() {
    check_image();
  }, false);
  // $('#dialog_write_image').change(function(e) {
  //     check_image();
  // });
  function check_image() {
    var image_name = event.srcElement.value;
    if((/(.gif|.jpg|.bmp|.png)$/i).test(image_name)){
      //print file path
      document.getElementById("print_selected_imagename").value = image_name; //input 이미지 경로
      //이미지 임시 보기
      document.getElementsByClassName("userimage_main")[0].src = URL.createObjectURL(document.getElementById("dialog_write_image").files[0]);         //이미지
      //document.getElementById("dialog_write_image").classList.add("round_image");
      
      //$('#userimage_main').attr('data-src', document.getElementById("userimage_main").src);  //이미지 확대할 때 소스
    } else if (image_name == "") {
    } else {
      messagebox_show(false, "이미지 저장", "gif, jpg, bmp, png 파일만 저장 가능합니다.", null, false, true);
    }
  }
  ///////////////////////////////////////////////////////////////////////



  ////////////////////////////
  //창 종료
  ////////////////////////////
  //창 닫기 (확인버튼)
  function save_usercanvas() {
    var title_text = document.getElementById('dialog-title1-userscanvas').textContent;
    if (title_text == "담당자 추가") {
      current_userinfo = null;
      send_userinfo(true);
    } else {
      send_userinfo(false);
    }
  }
  document.getElementById('btnSave_userscanvas').addEventListener('click', function(e) {
    save_usercanvas();
  });
  document.getElementById('btnSave_userscanvas').addEventListener('touchstart', function(e) {  
    save_usercanvas();
  });

  function send_userinfo(isAdd) {
    //정보 추가일 경우 중복 확인 필수
    // if (isAdd) {
    //   if (sendRead_checkID == false) {
    //     messagebox_show(false, "아이디 중복 확인", "아이디 중복 확인을 하셔야 합니다.", null, false, true);
    //     return;
    //   }
    // }

    //파일 가져오기    
    var getImageFile = document.getElementById("dialog_write_image").files[0];
    // if (getImageFile == undefined) {
    //   messagebox_show(false, "이미지 선택", null, null, false, true);
    // }

    // //수정일 경우 등록일자 변경하지 않기
    // var regist_datetime = currentDateTime();
    // if (isAdd == false) {
    //   regist_datetime = document.getElementById("dialog_write_regist_datetime").value;
    // }
    
    //셀렉트 박스
    var mb_position_value = "";
    if (document.getElementById("dialog_write_position").selectedIndex > -1) {
      mb_position_value = document.getElementById("dialog_write_position").options[document.getElementById("dialog_write_position").selectedIndex].text;
    }
      
    FileToBase64(getImageFile, function(result_image) {
      var statususer_temp = sessionStorage.getItem("current_menu");
      if (statususer_temp == null) {
        statususer_temp = "mainmenu_canvas_1";
      }

      var sendData = current_userinfo;
      if (sendData == null) {
        sendData = {
          mb_id: "",
          mb_email: "",
          mb_auth: "",
          mb_x: "100px",
          mb_y: "100px",

          mb_name: "",
          mb_position: "",
          mb_mobile: "",
          mb_task_1: "",
          mb_task_2: "",
          mb_task_3: "",
          mb_task_4: "",
          mb_type: "type1",
          mb_statususer: statususer_temp,
          mb_scale: "1",
          mb_regist_datetime: currentDateTime(),
          mb_lastsave_datetime: currentDateTime(),
          mb_image: "",            
          mb_work_state: "",
        }
      }
      
      sendData.mb_name = document.getElementById("dialog_write_name").value;
      sendData.mb_position = mb_position_value;
      sendData.mb_mobile = document.getElementById("dialog_write_mobile").value;
      sendData.mb_task_1 = document.getElementById("dialog_write_task_1").value;
      sendData.mb_task_2 = document.getElementById("dialog_write_task_2").value;
      sendData.mb_task_3 = document.getElementById("dialog_write_task_3").value;
      sendData.mb_task_4 = document.getElementById("dialog_write_task_4").value;
      sendData.mb_type = document.getElementById("dialog_write_type").value;
      sendData.mb_scale = document.getElementById("dialog_write_scale").value;
      //sendData.mb_regist_datetime = currentDateTime();
      sendData.mb_lastsave_datetime = currentDateTime();
      if (result_image != null) {
        sendData.mb_image = result_image;
      } else {
        //sendData.mb_image = null;
      }

      if (document.getElementById("dialog_write_user_id_wrap").getElementsByClassName("stretch_left_100percent")[0].style.borderColor == "rgb(241, 241, 241)") {
          sendData.mb_work_state = "근무중";
      } else if (document.getElementById("dialog_write_user_id_wrap").getElementsByClassName("stretch_left_100percent")[0].style.borderColor == "rgb(255, 102, 0)") {
          sendData.mb_work_state = "부재중";
      }

      //indexed db create, edit
      indexedDB_open(function(e) {
        var transaction = e.transaction(["yj_member"], "readwrite");
        var store = transaction.objectStore("yj_member");
        var request;

        if (isAdd) {
          request = store.add(sendData);
        } else {
          request = store.get(sendData.no);
        }

        request.onerror = function(e) {
            //  console.log("Error",e.target.error.name);                         
        }
        
        request.onsuccess = function(e) {                        
          //데이터 추가, 수정
          if (isAdd) {
            sendData.no = parseInt(e.target.result) || 0;                    //서버로부터 반환된 자동증가번호 저장 (고유번호: no)
            app_dialog.table.row.add(sendData).draw(false);   //gui 추가
            app_dialog.dataSet.push(sendData);                //dataSet 추가


            //list 추가
            list_users.push(sendData);

            //GUI 추가
            //create template
            
            var canvas_main = document.getElementById('userscanvas_main');    
            var template1 = document.getElementsByClassName("user_info_template_1")[0];     //get user_info_template_1
            var template1_1 = document.getElementsByClassName("user_info_template_1_1")[0];     //get user_info_template_1
            var template2 = document.getElementsByClassName("user_info_template_2")[0];     //get user_info_template_2
            var template3 = document.getElementsByClassName("user_info_template_3")[0];     //get user_info_template_3
            var template4 = document.getElementsByClassName("user_info_template_4")[0];     //get user_info_template_4
            var template5 = document.getElementsByClassName("user_info_template_5")[0];     //get user_info_template_5
            var template6 = document.getElementsByClassName("user_info_template_6")[0];     //get user_info_template_5
            var template_range1 = document.getElementsByClassName("user_info_template_range1")[0];     //get user_info_template_5
            
            if (sendData.mb_type != null) {
                if (sendData.mb_type == "type1") {
                    getElement = template1.cloneNode(true);      //create element
                } else if (sendData.mb_type == "type1_1") {
                    getElement = template1_1.cloneNode(true);      //create element
                } else if (sendData.mb_type == "type2") {
                    getElement = template2.cloneNode(true);      //create element
                } else if (sendData.mb_type == "type3") {
                    getElement = template3.cloneNode(true);      //create element
                } else if (sendData.mb_type == "type4") {
                    getElement = template4.cloneNode(true);      //create element
                } else if (sendData.mb_type == "type5") {
                    getElement = template5.cloneNode(true);      //create element
                } else if (sendData.mb_type == "type6") {
                    getElement = template6.cloneNode(true);      //create element
                } else if (sendData.mb_type == "type_range1") {
                    getElement = template_range1.cloneNode(true);      //create element
                }
            } else {
                getElement = template1.cloneNode(true);      //create element
            }

            getElement.style.display = "block"; 
            
            canvas_main.appendChild(getElement);            //add gui  
            dragElement(getElement);                        //set drag
            setElement_init(getElement, sendData);     //set data



            messagebox_show(false, "데이터 저장", "사용자 정보가 추가되었습니다.", null, false, true);
          } else {
            //db update
            var data = e.target.result;
            
            // data.mb_id = sendData.mb_id;
            data.mb_name = sendData.mb_name;
            //data.mb_email = sendData.mb_email;
            data.mb_mobile = sendData.mb_mobile;
            //data.mb_sex = sendData.mb_sex;
            //data.mb_addr_1 = sendData.mb_addr_1;
            //data.mb_addr_2 = sendData.mb_addr_2;
            //data.mb_addr_3 = sendData.mb_addr_3;
            //data.mb_post = sendData.mb_post;
            // data.mb_regist_datetime = sendData.mb_regist_datetime;
            data.mb_lastsave_datetime = sendData.mb_lastsave_datetime;
            // data.mb_out_datetime = sendData.mb_out_datetime;
            // data.mb_userinfo_delete = sendData.mb_userinfo_delete;
            // data.mb_license = sendData.mb_license;
            // data.mb_license_date = sendData.mb_license_date;
            // data.mb_sns = sendData.mb_sns;
            // data.mb_dept = sendData.mb_dept;
            data.mb_position = sendData.mb_position;
            // data.mb_statususer = sendData.mb_statususer;
            data.mb_type = sendData.mb_type;
            data.mb_task_1 = sendData.mb_task_1;
            data.mb_task_2 = sendData.mb_task_2;
            data.mb_task_3 = sendData.mb_task_3;
            data.mb_task_4 = sendData.mb_task_4;
            data.mb_image = sendData.mb_image;
            // data.mb_x = sendData.mb_x;
            // data.mb_y = sendData.mb_y;
            data.mb_scale = sendData.mb_scale;
            // data.mb_code_device = sendData.mb_code_device;
            data.mb_work_state = sendData.mb_work_state;
            // data.mb_etc = sendData.mb_etc;

            var objRequest = store.put(data);




            //기존데이터 삭제
            var get_user_no = document.getElementsByClassName("user_info_canvas_label_text_no");
            for (var i = 0; i < get_user_no.length; i++) {
                if (get_user_no[i].textContent == sendData.no) {
                    get_user_no[i].parentElement.parentElement.parentElement.remove();
                }
            }

            //window.location.reload();
            var canvas_main = document.getElementById('userscanvas_main');    
            var template1 = document.getElementsByClassName("user_info_template_1")[0];     //get user_info_template_1
            var template1_1 = document.getElementsByClassName("user_info_template_1_1")[0];     //get user_info_template_1
            var template2 = document.getElementsByClassName("user_info_template_2")[0];     //get user_info_template_2
            var template3 = document.getElementsByClassName("user_info_template_3")[0];     //get user_info_template_3
            var template4 = document.getElementsByClassName("user_info_template_4")[0];     //get user_info_template_4
            var template5 = document.getElementsByClassName("user_info_template_5")[0];     //get user_info_template_5
            var template6 = document.getElementsByClassName("user_info_template_6")[0];     //get user_info_template_5
            var template_range1 = document.getElementsByClassName("user_info_template_range1")[0];     //get user_info_template_5
            create_Element_one(sendData, canvas_main, template1, template1_1, template2, template3, template4, template5, template6, template_range1);

            messagebox_show(false, "데이터 저장", "사용자 정보가 수정되었습니다.", null, false, false);
            
            // //db update
            // var data = e.target.result;
            
            // // data.mb_id = sendData.mb_id;
            // data.mb_name = sendData.mb_name;
            // //data.mb_email = sendData.mb_email;
            // data.mb_mobile = sendData.mb_mobile;
            // //data.mb_sex = sendData.mb_sex;
            // //data.mb_addr_1 = sendData.mb_addr_1;
            // //data.mb_addr_2 = sendData.mb_addr_2;
            // //data.mb_addr_3 = sendData.mb_addr_3;
            // //data.mb_post = sendData.mb_post;
            // // data.mb_regist_datetime = sendData.mb_regist_datetime;
            // data.mb_lastsave_datetime = sendData.mb_lastsave_datetime;
            // // data.mb_out_datetime = sendData.mb_out_datetime;
            // // data.mb_userinfo_delete = sendData.mb_userinfo_delete;
            // // data.mb_license = sendData.mb_license;
            // // data.mb_license_date = sendData.mb_license_date;
            // // data.mb_sns = sendData.mb_sns;
            // // data.mb_dept = sendData.mb_dept;
            // data.mb_position = sendData.mb_position;
            // // data.mb_statususer = sendData.mb_statususer;
            // data.mb_type = sendData.mb_type;
            // data.mb_task_1 = sendData.mb_task_1;
            // data.mb_task_2 = sendData.mb_task_2;
            // data.mb_task_3 = sendData.mb_task_3;
            // data.mb_task_4 = sendData.mb_task_4;
            // data.mb_image = sendData.mb_image;
            // // data.mb_x = sendData.mb_x;
            // // data.mb_y = sendData.mb_y;
            // data.mb_scale = sendData.mb_scale;
            // // data.mb_code_device = sendData.mb_code_device;
            // data.mb_work_state = sendData.mb_work_state;
            // // data.mb_etc = sendData.mb_etc;

            // var objRequest = store.put(data);
    
            // //gui 수정
            // //모든 엘리먼트를 검색하여 고유번호가 동일한 값을 찾아서 내용 업데이트
            // var get_user_no = document.getElementsByClassName("user_info_canvas_label_text_no");
            // for (var i = 0; i < get_user_no.length; i++) {
            //   if (get_user_no[i].textContent == sendData.no) {
            //     //이미지 변경
            //     if ((sendData.mb_image == null) || (sendData.mb_image == "")) {
            //       get_user_no[i].parentElement.parentElement.getElementsByClassName("user_info_template_content_image")[0].src = "/images/user_sample.png";
            //     } else {
            //       get_user_no[i].parentElement.parentElement.getElementsByClassName("user_info_template_content_image")[0].src = sendData.mb_image;
            //     }                  

            //     //텍스트 내용 변경
            //     get_user_no[i].parentElement.getElementsByClassName("user_info_canvas_label_text_title")[0].textContent = sendData.mb_name;
            //     get_user_no[i].parentElement.getElementsByClassName("user_info_canvas_label_text_content1")[0].textContent = sendData.mb_position;
            //     get_user_no[i].parentElement.getElementsByClassName("user_info_canvas_label_text_content2")[0].textContent = sendData.mb_task_1;
            //     get_user_no[i].parentElement.getElementsByClassName("user_info_canvas_label_text_content3")[0].textContent = sendData.mb_task_2;
                
            //     //GUI 스타일 변경                                
            //     //클래스 삭제
            //     get_user_no[i].parentElement.parentElement.parentElement.className = "";
            //     get_user_no[i].parentElement.parentElement.className = "";
            //     get_user_no[i].parentElement.parentElement.childNodes[1].className = "";
            //     get_user_no[i].parentElement.parentElement.childNodes[3].className = "";
            //     get_user_no[i].classList.className = "";
            //     //get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[1].className = "";
            //     get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[3].className = "";
            //     get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[5].className = "";
            //     get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[7].className = "";
            //     get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[9].className = "";

            //     //클래스 추가
            //     var class_name = "user_info_template_1";
            //     if (sendData.mb_type != null) {
            //       if (sendData.mb_type == "type1") {
            //         get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_1");
            //         get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
            //       } else if (sendData.mb_type == "type1_1") {
            //         get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_1_1");
            //         get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
            //       } else if (sendData.mb_type == "type2") {
            //         get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_2");
            //         get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
            //       } else if (sendData.mb_type == "type3") {
            //         get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_3");
            //         get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
            //       } else if (sendData.mb_type == "type4") {
            //         get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_4");
            //         get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
            //       } else if (sendData.mb_type == "type5") {
            //         get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_5");
            //         get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
            //       } else if (sendData.mb_type == "type6") {
            //         get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_6");
            //         get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
            //       }
            //     }
                
            //     get_user_no[i].parentElement.parentElement.classList.add("stretch_wrap");
            //     get_user_no[i].parentElement.parentElement.childNodes[1].classList.add("user_info_template_content_1");
            //     get_user_no[i].parentElement.parentElement.childNodes[3].classList.add("user_info_template_content_2");
            //     get_user_no[i].classList.add("user_info_canvas_label_text_no");
            //     //get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[1].className = "user_info_canvas_label_text_no";
            //     get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[3].className = "user_info_canvas_label_text_title";
            //     get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[5].className = "user_info_canvas_label_text_content1";
            //     get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[7].className = "user_info_canvas_label_text_content2";
            //     get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[9].className = "user_info_canvas_label_text_content3";

            //     //get_user_no[i].parentElement.parentElement.parentElement.classList.add(class_name);

            //     break;
            //   }
            // }

            // messagebox_show(false, "데이터 저장", "사용자 정보가 수정되었습니다.", null, false, false);
          }
        }
      });


      // //JSON
      // var url = url_json + "jsonservice/rfms/update_userinfo_ftms";      //insert / update 선택
      // if (isAdd) {
      //   url = url_json + "jsonservice/rfms/insert_userinfo";
      // }
      // //var url = "http://127.0.0.1:31419/jsonservice/rfms/insert_userinfo";
      // JSON_POST(url, sendData, false, sessionStorage.getItem(token_yj_rfms), function (result) {
      //   if (result[0] == "ok") {
      //     messagebox_show(false, "데이터 저장", result, null, false, true);

      //     //모든 엘리먼트를 검색하여 고유번호가 동일한 값을 찾아서 내용 업데이트
      //     var get_user_no = document.getElementsByClassName("user_info_canvas_label_text_no");
      //     for (var i = 0; i < get_user_no.length; i++) {
      //       if (get_user_no[i].textContent == sendData.no) {
      //         //텍스트 내용 변경
      //         get_user_no[i].parentElement.getElementsByClassName("user_info_canvas_label_text_title")[0].textContent = sendData.mb_name;
      //         get_user_no[i].parentElement.getElementsByClassName("user_info_canvas_label_text_content1")[0].textContent = sendData.mb_position;
      //         get_user_no[i].parentElement.getElementsByClassName("user_info_canvas_label_text_content2")[0].textContent = sendData.mb_task_1;
      //         get_user_no[i].parentElement.getElementsByClassName("user_info_canvas_label_text_content3")[0].textContent = sendData.mb_task_2;
              
      //         //GUI 스타일 변경                                
      //         //클래스 삭제
      //         get_user_no[i].parentElement.parentElement.parentElement.className = "";
      //         get_user_no[i].parentElement.parentElement.className = "";
      //         get_user_no[i].parentElement.parentElement.childNodes[1].className = "";
      //         get_user_no[i].parentElement.parentElement.childNodes[3].className = "";
      //         get_user_no[i].classList.className = "";
      //         //get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[1].className = "";
      //         get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[3].className = "";
      //         get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[5].className = "";
      //         get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[7].className = "";
      //         get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[9].className = "";

      //         //클래스 추가
      //         var class_name = "user_info_template_1";
      //         if (sendData.mb_type != null) {
      //           if (sendData.mb_type == "type1") {
      //             get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_1");
      //             get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
      //           } else if (sendData.mb_type == "type2") {
      //             get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_2");
      //             get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
      //           } else if (sendData.mb_type == "type3") {
      //             get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_3");
      //             get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
      //           } else if (sendData.mb_type == "type4") {
      //             get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_4");
      //             get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
      //           } else if (sendData.mb_type == "type5") {
      //             get_user_no[i].parentElement.parentElement.parentElement.classList.add("user_info_template_5");
      //             get_user_no[i].parentElement.parentElement.parentElement.style.transform = "scale(" + sendData.mb_scale + ")";
      //           }
      //         }
              
      //         get_user_no[i].parentElement.parentElement.classList.add("stretch_wrap");
      //         get_user_no[i].parentElement.parentElement.childNodes[1].classList.add("user_info_template_content_1");
      //         get_user_no[i].parentElement.parentElement.childNodes[3].classList.add("user_info_template_content_2");
      //         get_user_no[i].classList.add("user_info_canvas_label_text_no");
      //         //get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[1].className = "user_info_canvas_label_text_no";
      //         get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[3].className = "user_info_canvas_label_text_title";
      //         get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[5].className = "user_info_canvas_label_text_content1";
      //         get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[7].className = "user_info_canvas_label_text_content2";
      //         get_user_no[i].parentElement.parentElement.childNodes[3].childNodes[9].className = "user_info_canvas_label_text_content3";

      //         //get_user_no[i].parentElement.parentElement.parentElement.classList.add(class_name);

      //         break;
      //       }
      //     }
      //   } else {
      //     messagebox_show(false, "데이터 저장 실패", result, null, false, true);
      //   }
      // });
    });

  }
  
  


  var is_show_dialog_userinfo = false;
  var os_value = getOS();

  if(os_value == "Windows") {
    document.getElementById('btnRemove_userscanvas').addEventListener('click', function(e) {
      remove_usercanvas(e);
    });

    document.getElementById('btnCancel_userscanvas').addEventListener('click', function(e) {    
      userscanvas_close();
      checkSignPage();
    });

    document.getElementById('dialog-close-id_remove_userscanvas').addEventListener('click', function() {
      userscanvas_close();
      checkSignPage();
    });

    //바탕 화면 터치 시 다이어로그 사라짐
    document.getElementsByClassName('modal-container')[0].addEventListener('click', function () {
        if (is_show_dialog_userinfo) {
            is_show_dialog_userinfo = false;  //초기화
        } else {
            userscanvas_close();
            checkSignPage();
        }
    });

    //팝업 다이어로그 터치 시 다이어로그 사라지지 않게 함
    document.getElementsByClassName('modal-content')[0].addEventListener('click', function () {
        is_show_dialog_userinfo = true;
    }); 

  } else {
    document.getElementById('btnRemove_userscanvas').addEventListener('touchstart', function(e) {    
      remove_usercanvas(e);
    });

    //document.getElementById('btnCancel_userscanvas').addEventListener('touchstart', function(e){
    //  userscanvas_close();  
    //  checkSignPage();
    //}, false);	//false일 경우 버블링, true일 경우 캡쳐링

    document.getElementById('dialog-close-id_remove_userscanvas').addEventListener('touchstart', function(e){
      userscanvas_close();
      checkSignPage();
    }, false);

    //바탕 화면 터치 시 다이어로그 사라짐
    document.getElementsByClassName('modal-container')[0].addEventListener('touchstart', function () {
        if (is_show_dialog_userinfo) {
            is_show_dialog_userinfo = false;  //초기화
        } else {
            userscanvas_close();
            checkSignPage();
        }
    });

    //팝업 다이어로그 터치 시 다이어로그 사라지지 않게 함
    document.getElementsByClassName('modal-content')[0].addEventListener('touchstart', function () {
        is_show_dialog_userinfo = true;
    });   
  }
  

  function remove_usercanvas(e) {
    userscanvas_close();

    //indexed DB delete
    indexedDB_open(function(e) {
      var transaction = e.transaction(["yj_member"], "readwrite");
      var store = transaction.objectStore("yj_member");
      var sendData = current_userinfo;
      
      //db삭제
      var request = store.delete(sendData.no);
            
      //gui 삭제
      var canvas_main = document.getElementById('userscanvas_main');
      var get_elements = canvas_main.getElementsByClassName("user_info_canvas_label_text_no")
      for (var i = 0; i<get_elements.length; i++){
        if (get_elements[i].textContent == sendData.no) {
          canvas_main.removeChild(get_elements[i].parentElement.parentElement.parentElement);
          break;
        }
      }

      //결과 출력
      messagebox_show(false, "데이터 삭제 완료", "데이터가 삭제 되었습니다.", null, false, true);
    });
  }

  function checkSignPage() {
    //히든 메시지 박스에 5959(사용자 로그인이 되지 않음)가 출력되어 있다면 로그인을 할 수 있는 페이지로 이동
    var hidden_message = document.getElementById('dialog-title2-userscanvas_hidden_status').textContent;
    if (hidden_message != "") {
      switch (hidden_message) {
        case "5959":
          window.location.href = "/index.html";
          break;
      }
    }

    document.getElementById('dialog-title2-userscanvas_hidden_status').textContent = "";
  }
  
  window.addEventListener("keydown", function(e){
    if (e.keyCode == 27) {                    //esc
      if (check_dialog_visible("dialog_messagebox") == true) {
        messagebox_close();                   //dialog_messagebox.html 페이지 함수
      } else {
        userscanvas_close();
      }
    }
  });

  //사용자 정보 창 닫기
    function userscanvas_close() {
        setTimeout(function () {                                 //0.1초 후 터치 가능 상태로 변경
            set_gui_admin(true);

            var getDialog = document.getElementById("dialog_userscanvas");

            if (getDialog != null) {
                getDialog.classList.remove('dialog-container--visible');

                // //body scoll on
                // scroll_body_on_off(true);        
            }

            //중복 터치 막기 (창을 닫은 후 바로 실행되어 창이 종료)
            if (sessionStorage.getItem("isTouched") == "true") {
                return;
            }

            sessionStorage.setItem("isTouched", "true");            //터치 안되게 적용
            setTimeout(function () {                                 //0.1초 후 터치 가능 상태로 변경
                sessionStorage.setItem("isTouched", "false");
            }, 100);
        }, 20);
    }

</script>