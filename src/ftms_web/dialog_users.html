<div class="modal-container">
  <div class="modal-window">
    <div class="modal-content">
    <!--페이지 타이틀-->
			<div class="dialog-title1" style="position: absolute">
      <ul>
        <li>
            <h5 id="dialog-title1-dialog_container_main">데이터 추가</h5>
        </li>
        <li style="float:right">
            <img id="dialog-close-id_dialog_users" class="dialog-close" src="/images/close2.png" />
        </li>
      </ul>
    </div>

    <div class="margin_33px"></div>
    
    <div>
      <div class="margin_10px"></div>
      <!-- <div id="dialog-title2-dialog_container_main" class="dialog-title2">제품의 데이터를 추가하여 주시기 바랍니다.</div> -->
      <div class="stretch_wrap layout_max1000" style="height:80px;">
        <div class="stretch_left_100percent" style="right:80px;">
          <div id="dialog-title2-dialog_container_main" class="dialog-title2">제품의 데이터를 추가하여 주시기 바랍니다.</div>
        </div>
        <div class="stretch_right_100px" style="max-width:80px">
          <img id="dialog_write_image_1" src="/images/user3.png" class="round_image" data-magnify="gallery">
        </div>
      </div>
      <div class="margin_10px"></div>
    </div>

    <div id="container" class="layout_max1000">
      <!--content//-->
      <div id="content">
          <div id="dialog_write">
            <table cellspacing="0" cellpadding="0" class="table_layout">
              <colgroup>
                <col width="25%" style="min-width:100px">
                <col width="75%">
              </colgroup>
              
              <tbody>
              <tr>
              </tr>
              <tr style="display:none">
                <th>아이디</th>
                <td>
                    <div class="stretch_wrap" style="height:36px">
                      <div id="dialog_write_user_id_wrap" class="stretch_left_100percent" style="right:80px;">
                        <input id="dialog_write_user_id" type="text" size="30" maxlength="20" class="inputbox1 mustimage" value="test" style="white-space:nowrap">
                      </div>
                      <div id="dialog_write_check_user_wrap" class="stretch_right_100px" style="max-width:80px">
                        <a id="dialog_write_check_user" href="#" class="button_style1">중복 확인</a>
                      </div>
                    </div>
                </td>
              </tr>
              <tr style="display:none">
                <th>비밀번호</th>
                <td>
                  <div class="stretch_wrap" style="height:36px">
                    <div id="dialog_write_password_wrap" class="stretch_left_100percent" style="right:80px;">
                      <input id="dialog_write_password" type="password" class="inputbox1 mustimage" maxlength="30">
                    </div>
                    <div id="dialog_write_password_change_warp" class="stretch_right_100px" style="max-width:80px">
                      <a id="dialog_write_password_change" href="#" class="button_style1">변경</a>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <th>이름</th>
                <td><input id="dialog_write_name" type="text" class="inputbox1" maxlength="30"></td>
              </tr>
              <tr style="display:none">
                <th>이메일</th>
                <td><input id="dialog_write_email" type="text" class="inputbox1" maxlength="50"></td>
              </tr>
              <tr style="display:none">
                <th>모바일</th>
                <td><input id="dialog_write_mobile" type="text" class="inputbox1" maxlength="30"></td>
              </tr>
              <tr style="display:none">
                <th>고유번호</th>
                <td><input id="dialog_write_no" type="text" class="inputbox1" maxlength="30" readonly></td>
              </tr>
              <tr>
                <th>등록일자</th>
                <td><input id="dialog_write_regist_datetime" type="text" class="inputbox1" maxlength="30" readonly></td>
              </tr>
              <tr>
                <th>최종수정일자</th>
                <td><input id="dialog_write_lastsave_datetime" type="text" class="inputbox1" maxlength="30" readonly></td>
              </tr>
              <tr style="display:none">
                <th>라이선스</th>
                <td>
                  <div class="stretch_wrap" style="height:36px">
                    <div class="stretch_left_100percent" style="right:36px;margin-right: 3px">
                        <input id="dialog_write_license_date" type="text" class="inputbox1" maxlength="30">
                    </div>
                    <div class="stretch_right_100px" style="max-width:36px">
                      <div id="dialog_write_license_date_divimage" class="datepicker1" style="width:100%;height:100%;padding:1px;">

                      </div>
                    </div>
                    <!-- <div id="dialog_write_license_date_divimage" class="stretch_right_100px datepicker1" style="max-width:36px">
                    </div> -->
                  </div>
                </td>
              </tr>
              <!-- <tr>
                <th>권한</th>
                <td>
                  <select id="dialog_write_auth" class="select1">
                  </select>
                </td>
              </tr> -->
              <tr style="display:none">
                <th>권한</th>
                <td>
                  <div class="stretch_wrap" style="height:36px">
                    <div id="dialog_write_auth_wrap" class="stretch_left_100percent" style="right:80px;">
                      <select id="dialog_write_auth" class="select1">
                      </select>
                    </div>
                    <div id="dialog_write_auth_change_warp" class="stretch_right_100px" style="max-width:80px">
                      <a id="dialog_write_auth_change" href="#" class="button_style1">찾기</a>
                    </div>
                  </div>
                </td>
              </tr>
              <tr style="display:none">
                <th>부서</th>
                <td>
                  <div class="stretch_wrap" style="height:36px">
                    <div id="dialog_write_dept_wrap" class="stretch_left_100percent" style="right:80px;">
                      <select id="dialog_write_dept" class="select1">
                      </select>
                    </div>
                    <div id="dialog_write_dept_change_warp" class="stretch_right_100px" style="max-width:80px">
                      <a id="dialog_write_dept_change" href="#" class="button_style1">찾기</a>
                    </div>
                  </div>
                </td>
              </tr>

              <!-- <tr>
                <th>부서</th>
                <td>
                  <select id="dialog_write_dept" class="select1">
                    <option value="일반사용자">일반사용자&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</option>
                    <option value="운영">운영</option>
                    <option value="운영관리자">운영관리자</option>
                    <option value="영업">영업</option>
                    <option value="영업관리자">영업관리자</option>
                    <option value="시스템관리자">시스템관리자</option>
                    <option value="admin">admin</option>
                    <option value="기타">기타</option>
                  </select>
                </td>
              </tr> -->
              <!-- <tr>
                <th>직책</th>
                <td><input id="dialog_write_position" type="text" class="inputbox1" maxlength="100"></td>
              </tr> -->
              <tr>
                <th>직책</th>
                <td>
                  <div class="stretch_wrap" style="height:36px">
                    <div id="dialog_write_position_wrap" class="stretch_left_100percent" style="right:80px;">
                      <select id="dialog_write_position" class="select1">
                      </select>
                    </div>
                    <div id="dialog_write_position_change_warp" class="stretch_right_100px" style="max-width:80px">
                      <a id="dialog_write_position_change" href="#" class="button_style1">찾기</a>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <th>분류</th>
                <td>
                  <div class="stretch_wrap" style="height:36px">
                    <div id="dialog_write_statususer_wrap" class="stretch_left_100percent" style="right:80px;">
                      <select id="dialog_write_statususer" class="select1">
                      </select>
                    </div>
                    <div id="dialog_write_statususer_change_warp" class="stretch_right_100px" style="max-width:80px">
                      <a id="dialog_write_statususer_change" href="#" class="button_style1">찾기</a>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <th>타입</th>
                <td>
                  <select id="dialog_write_type" class="select1">
                    <option value="type1">type1</option>
                    <option value="type1_1">type1_1</option>
                    <option value="type2">type2</option>
                    <option value="type3">type3</option>
                    <option value="type4">type4</option>
                    <option value="type5">type5</option>
                    <option value="type6">type6</option>
                    <option value="type_range1">type_range1</option>
                  </select>
                </td>
              </tr>
              <tr>
                <th>업무1</th>
                <td><input id="dialog_write_task_1" type="text" class="inputbox1" maxlength="30"></td>
              </tr>
              <tr>
                <th>업무2</th>
                <td><input id="dialog_write_task_2" type="text" class="inputbox1" maxlength="30"></td>
              </tr>
              <tr>
                <th>업무3</th>
                <td><input id="dialog_write_task_3" type="text" class="inputbox1" maxlength="30"></td>
              </tr>
              <tr>
                <th>업무4</th>
                <td><input id="dialog_write_task_4" type="text" class="inputbox1" maxlength="30"></td>
              </tr>
              <tr style="display:none">
                <th>X좌표</th>
                <td><input id="dialog_write_x" type="text" class="inputbox1" maxlength="30"></td>
              </tr>
              <tr style="display:none">
                <th>Y좌표</th>
                <td><input id="dialog_write_y" type="text" class="inputbox1" maxlength="30"></td>
              </tr>
              <tr>
                <th>스케일</th>
                <td>
                  <select id="dialog_write_scale" class="select1">
                    <option value="0.4">0.4</option>
                    <option value="0.5">0.5</option>
                    <option value="0.6">0.6</option>
                    <option value="0.7">0.7</option>
                    <option value="0.8">0.8</option>
                    <option value="0.9">0.9</option>
                    <option value="1">1</option>
                    <option value="1.1">1.1</option>
                    <option value="1.2">1.2</option>
                    <option value="1.3">1.3</option>
                    <option value="1.4">1.4</option>
                    <option value="1.5">1.5</option>
                    <option value="1.6">1.6</option>
                    <option value="1.7">1.7</option>
                    <option value="1.8">1.8</option>
                    <option value="1.9">1.9</option>
                    <option value="2">2</option> 
                  </select>
                </td>
              </tr>

              <tr style="display:none">
                <th>RFID 코드</th>
                <td><input id="dialog_write_code_device" type="text" class="inputbox1" maxlength="30"></td>
              </tr>

              <tr>
                <th>이미지</th>
                <td>
                  <div class="stretch_wrap" style="height:36px">
                    <div class="stretch_left_100percent" style="right:36px;margin-right: 3px">
                      <input id="print_selected_imagename" type="text" class="inputbox1">
                    </div>                  
                    <div class="stretch_right_100px file_find" style="max-width:36px;">
                      <input id="dialog_write_image" type="file"/>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody></table>
          </div>
        
          <div class="dialog-buttons">
            <button id="btnSave_dialog_users" class="button">저장</button>
            <button id="btnCancel_dialog_users" class="button">취소</button>
          </div>
        </div>
          <!--//content-->
      </div>
    </div>
  </div>
</div>
  
<!-- loading message -->
<div class="loading-container div_center_horizontally_vertically" style="position:fixed;margin:auto;display:none;">
    <div class="loading"></div>
    <div id="loading-text">기다려주세요</div>
</div>

<script>
  //inputbox 포커스
  $(document).ready(function() {
    var sendRead_checkID = false;

    // //모바일 화면일 경우 다이어로그가 위로 올라가는 현상 수정 (리사이즈 적용)
    // window.onresize = function(event) {
    //   change_top_margin_users();
    // };
    // //모바일 화면일 경우 다이어로그가 위로 올라가는 현상 수정
    // change_top_margin_users();

    //부서, 권한, 직책 항목 추가
    selectDept();
    selectAuth();
    selectPosition(null, true);
    selectStatususer();


    //datepicker (달력)
    $('#dialog_write_license_date').datepicker({
      calendarWeeks: false,
      todayHighlight: true,
      autoclose: true,
      format: "yyyy-mm-dd",
      language: "ko-kr"
    }).on('changeDate', function (e) {  //datepicker selected event
      setInput_backgroundColor("dialog_write_license_date");
    });

    $('#dialog_write_license_date_divimage').click(function(){
       $(document).ready(function(){
          $("#dialog_write_license_date").datepicker().focus();

          $("#dialog_write_license_date").attr("readonly", true);
          setTimeout(function() {
            $("#dialog_write_license_date").attr("readonly", false);
          }, 10);
       });
    });

    ///////////////////////////////////////////////////////////////////////
    //이미지 뷰어
    imageViewer_init();
    //이미지 추가 이벤트
    document.getElementById('dialog_write_image').addEventListener('click', function() {
      this.value = null;      
    }, false);
    document.getElementById('dialog_write_image').addEventListener('change', function() {
      check_image();
    }, false);
    // $('#dialog_write_image').change(function(e) {
    //     check_image();
    // });
    function check_image() {
      var image_name = event.srcElement.value;
      if((/(.gif|.jpg|.bmp|.png)$/i).test(image_name)){
        //print file path
        document.getElementById("print_selected_imagename").value = image_name; //input 이미지 경로
        //이미지 임시 보기
        document.getElementById("dialog_write_image_1").src = URL.createObjectURL(document.getElementById("dialog_write_image").files[0]);         //이미지
        document.getElementById("dialog_write_image_1").classList.add("round_image");
        
        $('#dialog_write_image_1').attr('data-src', document.getElementById("dialog_write_image_1").src);  //이미지 확대할 때 소스
      } else if (image_name == "") {
      } else {
        messagebox_show(false, "이미지 저장", "gif, jpg, bmp, png 파일만 저장 가능합니다.", null, false, true);
      }
    }
    ///////////////////////////////////////////////////////////////////////


    //사용자 ID 중복 확인
    document.getElementById('dialog_write_check_user').addEventListener('click', function() {
      var input_userID = document.getElementById('dialog_write_user_id').value;
      if (input_userID.trim() == "") {
        messagebox_show(false, "사용자 확인", "사용자 아이디를 입력하여 주시기 바랍니다.", null, false, true);
        return;
      }

      send_checkUser(function(result) {
        if (result[0] == "ok") {
          sendRead_checkID = true;
        } else {
          sendRead_checkID = false;
        }

        //메시지박스 출력
        messagebox_show(false, "사용자 확인", result, null, false, true);
      });            
      //dialog_close();
    });


    //비밀번호 변경
    document.getElementById('dialog_write_password_change').addEventListener('click', function() {
      //dialog 보이기
      //dialog 생성여부 확인
      var dialog_write_password_change = document.getElementById("dialog_password_change");
      if (dialog_write_password_change != null) {
        dialog_write_password_change.classList.add('dialog-container--visible');
      }

      // dialog 내용 변경
      var userID = document.getElementById('dialog_write_user_id').value;
      //document.getElementById('dialog-title1-dialog_password_change').textContent = "비밀번호 변경";
      var c_text1 = "님의 ";
      if (userID.trim() == "") 
        c_text1 = "";

      document.getElementById('dialog_password_change_userid').textContent = userID;
      document.getElementById('dialog-title2-dialog_password_change').textContent = userID + c_text1 + "비밀번호를 변경합니다.";
      document.getElementById("dialog_write_password_change_image").src = document.getElementById("dialog_write_image_1").src;         //이미지 변경

      document.getElementById('dialog_password_change_previouspassword').value = "";
      document.getElementById('dialog_password_change_newpassword').value = "";
      document.getElementById('dialog_password_change_newpassword_check').value = "";
      

      //dialog 취소버튼 visible
      //document.getElementById('btnCancel_dialog_password_change').style.display = 'none';
      //body scoll on
      scroll_body_on_off(true);

      document.getElementById('btnSave_messagebox').focus();
    });

    ///////////////////
    //권한 변경
    ///////////////////
    document.getElementById('dialog_write_auth_change').addEventListener('click', function() {
      //컨테이너의 내용을 지우고 새 다이어로그 추가
      document.getElementById("dialog_container_pop").innerHTML = "";
      //스크립트 정의      
      var script = document.createElement('script');
      script.id = 'id_table_auth_pop';
      script.src = '/js/table_auth_pop.js';
      //script 추가 여부 확인 후 헤더 스크립트 삭제
      var scripts = document.getElementsByTagName('script');
      for (var i = scripts.length; i--;) {
        if (scripts[i].id == 'id_table_auth_pop') {
          document.head.removeChild(scripts[i])
          break;
        }
      }
      //헤더에 스크립트 추가
      document.head.appendChild(script);    
  
      //loading message
      document.getElementsByClassName('loading-container')[0].style.display = 'block';

      //권한 내용 추가      
      $("#dialog_container_pop").load("/dialog_auth_pop.html", function(e) {        
        load_dept_dialog_auth();
      });

      function load_dept_dialog_auth() {
        setTimeout(function() {          
          if (document.getElementById('table_main_pop_wrapper') == null) {
            load_dept_dialog_auth();
          } else {
            //loading message
            document.getElementsByClassName('loading-container')[0].style.display = 'none';

            //datatables GUI 안보이게 하기
            //document.getElementsByClassName('dt-buttons')[1].style.display = 'none';     //추가,삭제,엑셀, 기본뷰 버튼 보이지 않게 하기(dept_pop 다이어로그 종료시 원래대로)            
            var dt_button_count = 1;
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[0].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[1].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[2].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[3].style.display = 'none';

            app_dialog_pop.table.column(1).visible(false);      //columns visible, 체크박스 컬럼 안보이게 하기
            //document.getElementById('id_table_column_sequence_pop').style.display = 'none';   //좌측 상단 datatables + 버튼 안보이게 하기

            //dialog 보이기
            //dialog 생성여부 확인
            var dialog_write_auth_change = document.getElementById("dialog_container_pop");
            if (dialog_write_auth_change != null) {
              dialog_write_auth_change.classList.add('dialog-container--visible');
            }

            //dialog 취소버튼 visible
            //document.getElementById('btnCancel_dialog_auth_change').style.display = 'none';
            //body scoll on
            scroll_body_on_off(true);

            document.getElementById('btnSave_messagebox').focus();
          }
        }, 300);
      }
    });

    ///////////////////
    //부서 변경
    ///////////////////
    document.getElementById('dialog_write_dept_change').addEventListener('click', function() {
      //컨테이너의 내용을 지우고 새 다이어로그 추가
      document.getElementById("dialog_container_pop").innerHTML = "";
      //스크립트 정의
      var script = document.createElement('script');
      script.id = 'id_table_dept_pop';
      script.src = '/js/table_dept_pop.js';
      //script 추가 여부 확인 후 헤더 스크립트 삭제
      var scripts = document.getElementsByTagName('script');
      for (var i = scripts.length; i--;) {
        if (scripts[i].id == 'id_table_dept_pop') {
          document.head.removeChild(scripts[i])
          break;
        }
      }
      //헤더에 스크립트 추가
      document.head.appendChild(script);    
  
      //loading message
      document.getElementsByClassName('loading-container')[0].style.display = 'block';

      //부서 내용 추가      
      $("#dialog_container_pop").load("/dialog_dept_pop.html", function(e) {
        load_dept_dialog_users();
      });

      function load_dept_dialog_users() {
        setTimeout(function() {
          if (document.getElementById('table_main_pop_wrapper') == null) {
            load_dept_dialog_users();
          } else {
            //loading message
            document.getElementsByClassName('loading-container')[0].style.display = 'none';

            //datatables GUI 안보이게 하기
            //document.getElementsByClassName('dt-buttons')[1].style.display = 'none';     //추가,삭제,엑셀, 기본뷰 버튼 보이지 않게 하기(dept_pop 다이어로그 종료시 원래대로)
            var dt_button_count = 1;
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[0].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[1].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[2].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[3].style.display = 'none';

            app_dialog_pop.table.column(1).visible(false);      //columns visible, 체크박스 컬럼 안보이게 하기
            //document.getElementById('id_table_column_sequence_pop').style.display = 'none';   //좌측 상단 datatables + 버튼 안보이게 하기

            //dialog 보이기
            //dialog 생성여부 확인
            var dialog_write_dept_change = document.getElementById("dialog_container_pop");
            if (dialog_write_dept_change != null) {
              dialog_write_dept_change.classList.add('dialog-container--visible');
            }

            //dialog 취소버튼 visible
            //document.getElementById('btnCancel_dialog_dept_change').style.display = 'none';
            //body scoll on
            scroll_body_on_off(true);

            document.getElementById('btnSave_messagebox').focus(); 
          }
        }, 300);
      }
    });

    ///////////////////
    //직책 변경
    ///////////////////
    document.getElementById('dialog_write_position_change').addEventListener('click', function() {
      //컨테이너의 내용을 지우고 새 다이어로그 추가
      document.getElementById("dialog_container_pop").innerHTML = "";
      //스크립트 정의
      var script = document.createElement('script');
      script.id = 'id_table_position_pop';
      script.src = '/js/table_position_pop.js';
      //script 추가 여부 확인 후 헤더 스크립트 삭제
      var scripts = document.getElementsByTagName('script');
      for (var i = scripts.length; i--;) {
        if (scripts[i].id == 'id_table_position_pop') {
          document.head.removeChild(scripts[i])
          break;
        }
      }
      //헤더에 스크립트 추가
      document.head.appendChild(script);    
  
      //loading message
      document.getElementsByClassName('loading-container')[0].style.display = 'block';

      //직책 내용 추가
      $("#dialog_container_pop").load("/dialog_position_pop.html", function(e) {
        load_position_dialog_users();
      });

      function load_position_dialog_users() {
        setTimeout(function() {
          if (document.getElementById('table_main_pop_wrapper') == null) {
            load_position_dialog_users();
          } else {
            //loading message
            document.getElementsByClassName('loading-container')[0].style.display = 'none';

            //datatables GUI 안보이게 하기
            //document.getElementsByClassName('dt-buttons')[1].style.display = 'none';     //추가,삭제,엑셀, 기본뷰 버튼 보이지 않게 하기(dept_pop 다이어로그 종료시 원래대로)
            var dt_button_count = 1;
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[0].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[1].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[2].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[3].style.display = 'none';

            app_dialog_pop.table.column(1).visible(false);      //columns visible, 체크박스 컬럼 안보이게 하기
            //document.getElementById('id_table_column_sequence_pop').style.display = 'none';   //좌측 상단 datatables + 버튼 안보이게 하기

            //dialog 보이기
            //dialog 생성여부 확인
            var dialog_write_dept_change = document.getElementById("dialog_container_pop");
            if (dialog_write_dept_change != null) {
              dialog_write_dept_change.classList.add('dialog-container--visible');
            }

            //dialog 취소버튼 visible
            //document.getElementById('btnCancel_dialog_dept_change').style.display = 'none';
            //body scoll on
            scroll_body_on_off(true);

            document.getElementById('btnSave_messagebox').focus(); 
          }
        }, 300);
      }
    });

    ///////////////////
    //분류 변경
    ///////////////////
    document.getElementById('dialog_write_statususer_change').addEventListener('click', function() {
      //컨테이너의 내용을 지우고 새 다이어로그 추가
      document.getElementById("dialog_container_pop").innerHTML = "";
      //스크립트 정의
      var script = document.createElement('script');
      script.id = 'id_table_statususer_pop';
      script.src = '/js/table_statususer_pop.js';
      //script 추가 여부 확인 후 헤더 스크립트 삭제
      var scripts = document.getElementsByTagName('script');
      for (var i = scripts.length; i--;) {
        if (scripts[i].id == 'id_table_statususer_pop') {
          document.head.removeChild(scripts[i])
          break;
        }
      }
      //헤더에 스크립트 추가
      document.head.appendChild(script);    
  
      //loading message
      document.getElementsByClassName('loading-container')[0].style.display = 'block';

      //분류 내용 추가
      $("#dialog_container_pop").load("/dialog_statususer_pop.html", function(e) {
        load_statususer_dialog_users();
      });

      function load_statususer_dialog_users() {
        setTimeout(function() {
          if (document.getElementById('table_main_pop_wrapper') == null) {
            load_statususer_dialog_users();
          } else {
            //loading message
            document.getElementsByClassName('loading-container')[0].style.display = 'none';

            //datatables GUI 안보이게 하기
            //document.getElementsByClassName('dt-buttons')[1].style.display = 'none';     //추가,삭제,엑셀, 기본뷰 버튼 보이지 않게 하기(dept_pop 다이어로그 종료시 원래대로)
            var dt_button_count = 1;
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[0].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[1].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[2].style.display = 'none';
            document.getElementsByClassName('dt-buttons')[dt_button_count].getElementsByClassName('dt-button')[3].style.display = 'none';

            app_dialog_pop.table.column(1).visible(false);      //columns visible, 체크박스 컬럼 안보이게 하기
            //document.getElementById('id_table_column_sequence_pop').style.display = 'none';   //좌측 상단 datatables + 버튼 안보이게 하기

            //dialog 보이기
            //dialog 생성여부 확인
            var dialog_write_dept_change = document.getElementById("dialog_container_pop");
            if (dialog_write_dept_change != null) {
              dialog_write_dept_change.classList.add('dialog-container--visible');
            }

            //dialog 취소버튼 visible
            //document.getElementById('btnCancel_dialog_dept_change').style.display = 'none';
            //body scoll on
            scroll_body_on_off(true);

            document.getElementById('btnSave_messagebox').focus(); 
          }
        }, 300);
      }
      
    });




    //특수문자 제한
    document.getElementById('dialog_write_user_id').addEventListener('input', function(e) {
      var result = check_string2(this.value);           //공백, 특수문자 확인

      if (result != "ok") {
        messagebox_show(false, "입력값 제한", result, null, false, true);
        this.value = remove_space_string(this.value);   //공백제거
        this.value = remove_special_string(this.value); //특수문자 제거
      }
    });
    

    //데이터 삭제
    document.getElementById('btnSave_messagebox').addEventListener('click', function() {
      var title_messagebox = document.getElementById('dialog-title1-messagebox1').textContent;
      if (title_messagebox != "데이터 삭제") {
        return;
      }

      //체크박스 선택 데이터 가져오기 (app_dialog 변수는 table_users.js 파일에서 전역변수처럼 사용)
      var sendData = app_dialog.function_getSelectDataValue();
      

      //indexed DB delete
      indexedDB_open(function(e) {
        var transaction = e.transaction(["yj_member"], "readwrite");
        var store = transaction.objectStore("yj_member");

        //db삭제
        for (var i = 0; i < sendData.length; i++) {
          var request = store.delete(sendData[i]);
        }
              
        //gui 삭제
        for (var i = 0; i < sendData.length; i++) {
          for (var k = 0; k < app_dialog.table.rows().count(); k++) {
            if (sendData[i] == app_dialog.table.rows(k).data()[0].no) {                
              app_dialog.table.row(k).remove().draw(false);
              k--;
            }
          }            
        }

        //dataSet 삭제
        for (var i = 0; i < sendData.length; i++) {
          for (var k = 0; k < app_dialog.dataSet.length; k++) {
            if (sendData[i] == app_dialog.dataSet[k].no) {                
              app_dialog.dataSet.splice(k, 1);
              k--;
            }
          }            
        }

        //결과 출력
        messagebox_show(false, "데이터 삭제 완료", "데이터가 삭제 되었습니다.", null, false, true);

        // request.onsuccess = function(event) {
        //   //결과 출력
        //   messagebox_show(false, "데이터 삭제 완료", "데이터가 삭제 되었습니다.", null, false, true);
        //   //gui 삭제
        //   for (var i = 0; i < sendData.length; i++) {
        //     for (var k = 0; k < app_dialog.table.rows().count(); k++) {
        //       if (sendData[i] == app_dialog.table.rows(k).data()[0].no) {                
        //         app_dialog.table.row(k).remove().draw(false);
        //         k--;
        //       }
        //     }            
        //   }

        //   //dataSet 삭제
        //   for (var i = 0; i < sendData.length; i++) {
        //     for (var k = 0; k < app_dialog.dataSet.length; k++) {
        //       if (sendData[i] == app_dialog.dataSet[k].no) {                
        //         app_dialog.dataSet.splice(k, 1);
        //         k--;
        //       }
        //     }            
        //   }
        // }
      });

      // //JSON
      // var url = url_json + "jsonservice/rfms/delete_userinfo";      //delete
      // JSON_POST(url, sendData, false, sessionStorage.getItem(token_yj_rfms), function (result) {
      //   if (result[0] == "ok") {
      //     //결과 출력
      //     messagebox_show(false, "데이터 삭제 완료", result, null, false, true);
      //     //gui 삭제
      //     for (var i = 0; i < sendData.length; i++) {
      //       for (var k = 0; k < app_dialog.table.rows().count(); k++) {
      //         if (sendData[i] == app_dialog.table.rows(k).data()[0].no) {                
      //           app_dialog.table.row(k).remove().draw(false);
      //           k--;
      //         }
      //       }            
      //     }          

      //     //dataSet 삭제
      //     for (var i = 0; i < sendData.length; i++) {
      //       for (var k = 0; k < app_dialog.dataSet.length; k++) {
      //         if (sendData[i] == app_dialog.dataSet[k].no) {                
      //           app_dialog.dataSet.splice(k, 1);
      //           k--;
      //         }
      //       }            
      //     }

      //   } else {
      //     messagebox_show(false, "데이터 삭제 실패", result, null, false, true);
      //   }
      // });




    });


    ////////////////////////////
    //창 종료
    ////////////////////////////
    //저장 (확인버튼)
    document.getElementById('btnSave_dialog_users').addEventListener('click', function() {
      if (document.getElementById('dialog-title1-dialog_container_main').textContent == "사용자 정보 추가") {
        send_userinfo(true);
      } else if (document.getElementById('dialog-title1-dialog_container_main').textContent == "사용자 정보 일괄 수정") {
        //input text가 존재한다면 배경색을 변경
        var saveColumnName = check_inputdata();    ////값이 존재하는 db컬럼명 반환

        var mb_auth_value = "";
        if (document.getElementById("dialog_write_auth").selectedIndex > -1) {
          mb_auth_value = document.getElementById("dialog_write_auth").options[document.getElementById("dialog_write_auth").selectedIndex].text;
        }

        var mb_dept_value = "";
        if (document.getElementById("dialog_write_dept").selectedIndex > -1) {
          mb_dept_value = document.getElementById("dialog_write_dept").options[document.getElementById("dialog_write_dept").selectedIndex].text;
        }
        
        var mb_position_value = "";
        if (document.getElementById("dialog_write_position").selectedIndex > -1) {
          mb_position_value = document.getElementById("dialog_write_position").options[document.getElementById("dialog_write_position").selectedIndex].text;
        }

        var mb_statususer_value = "";
        if (document.getElementById("dialog_write_statususer").selectedIndex > -1) {
          //mb_statususer_value = document.getElementById("dialog_write_statususer").options[document.getElementById("dialog_write_statususer").selectedIndex].text;
          mb_statususer_value = document.getElementById("dialog_write_statususer").options[document.getElementById("dialog_write_statususer").selectedIndex].text;
          if (document.getElementById("dialog_write_statususer").selectedIndex == 0)
            mb_statususer_value = "mainmenu_canvas_1";
          else if (document.getElementById("dialog_write_statususer").selectedIndex == 1)
            mb_statususer_value = "mainmenu_canvas_2";
          else if (document.getElementById("dialog_write_statususer").selectedIndex == 2)
            mb_statususer_value = "mainmenu_canvas_3";
          else if (document.getElementById("dialog_write_statususer").selectedIndex == 3)
            mb_statususer_value = "mainmenu_canvas_4";
          else if (document.getElementById("dialog_write_statususer").selectedIndex == 4)
            mb_statususer_value = "mainmenu_canvas_5";
          else if (document.getElementById("dialog_write_statususer").selectedIndex == 5)
            mb_statususer_value = "mainmenu_canvas_6";
        }

        var mb_type_value = "";
        if (document.getElementById("dialog_write_type").selectedIndex > -1) {
          mb_type_value = document.getElementById("dialog_write_type").options[document.getElementById("dialog_write_type").selectedIndex].text;
        }

        var mb_scale_value = "";
        if (document.getElementById("dialog_write_scale").selectedIndex > -1) {
          mb_scale_value = document.getElementById("dialog_write_scale").options[document.getElementById("dialog_write_scale").selectedIndex].text;
        }
        

        //저장 메시지 출력 후 사용자가 확인 버튼을 누르면 db에 저장
        messagebox_show(true, "데이터 저장", "입력하신 정보를 일괄적으로 모두 변경하여 저장합니다. 계속하시겠습니까?", function(e) {
          if (e == "ok") {
            //save db
            //파일 가져오기
            var getImageFile = document.getElementById("dialog_write_image").files[0];
            FileToBase64(getImageFile, function(result_image) {
              var sendData = {
                no: parseInt(document.getElementById("dialog_write_no").value) || 0,
                //select: false,
                //mb_id: document.getElementById("dialog_write_user_id").value,
                //mb_password: document.getElementById("dialog_write_password").value,
                mb_name: document.getElementById("dialog_write_name").value,
                mb_email: document.getElementById("dialog_write_email").value,
                //mb_tel: "",
                mb_mobile: document.getElementById("dialog_write_mobile").value,
                //mb_sex: true,
                //mb_addr_1: "",
                //mb_addr_2: "",
                //mb_addr_3: "",
                //mb_post: "",
                // mb_regist_datetime: "2019-04-20 12:11:11",
                // mb_out_datetime: "2018-12-20 14:11:11",
                //mb_regist_datetime: regist_datetime,
                mb_lastsave_datetime: currentDateTime(),
                //mb_out_datetime: null,
                //mb_userinfo_delete: 1,
                //mb_license: 1,
                mb_license_date: document.getElementById("dialog_write_license_date").value,
                //mb_license_date: "2018-12-28",
                //mb_license_date: currentDate(),
                //mb_sns: "",                
                mb_auth: mb_auth_value,
                mb_dept: mb_dept_value,
                mb_position: mb_position_value,
                mb_statususer: mb_statususer_value,
                mb_type: mb_type_value,
                mb_task_1: document.getElementById("dialog_write_task_1").value,
                mb_task_2: document.getElementById("dialog_write_task_2").value,
                mb_task_3: document.getElementById("dialog_write_task_3").value,
                mb_task_4: document.getElementById("dialog_write_task_4").value,
                mb_x: document.getElementById("dialog_write_x").value,
                mb_y: document.getElementById("dialog_write_y").value,
                mb_scale: document.getElementById("dialog_write_scale").value,
                mb_code_device: document.getElementById("dialog_write_code_device").value,
                //mb_image: "",
                mb_image: result_image,
                //mb_work_state: 
                //mb_etc: "",
                batchSaveNo: app_dialog.function_getSelectDataValue(),
                batchSaveColumnName: saveColumnName,
              }


              //indexed db create, edit
              indexedDB_open(function(e) {
                var transaction = e.transaction(["yj_member"], "readwrite");
                var store = transaction.objectStore("yj_member");

                store.openCursor().onerror = function(e) {
                    //  console.log("Error",e.target.error.name);
                }
                
                store.openCursor().onsuccess = function(e) {
                  //db update
                  var cursor = e.target.result;

                  if (cursor) {
                    const updateData = cursor.value;

                    //선택한 번호가 아니라면 다음 데이터 확인
                    var isSelected = false;
                    for(var j=0; j<sendData.batchSaveNo.length; j++) {
                      if (sendData.batchSaveNo[j] == cursor.key) {
                        isSelected = true;
                        sendData.batchSaveNo.splice(j, 1);
                        break;
                      }
                    }
                    if (isSelected == false) {
                      cursor.continue();
                      return;
                    }

                    //데이터 업데이트
                  
                    for (i=0; i<sendData.batchSaveColumnName.length; i++) {
                      if (sendData.batchSaveColumnName[i] == "mb_name") {
                        updateData.mb_name = sendData.mb_name;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_email") {
                        updateData.mb_email = sendData.mb_email;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_mobile") {
                        updateData.mb_mobile = sendData.mb_mobile;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_lastsave_datetime") {
                        updateData.mb_lastsave_datetime = sendData.mb_lastsave_datetime;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_license_date") {
                        updateData.mb_license_date = sendData.mb_license_date;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_dept") {
                        updateData.mb_dept = sendData.mb_dept;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_position") {
                        updateData.mb_position = sendData.mb_position;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_statususer") {
                        updateData.mb_statususer = sendData.mb_statususer;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_type") {
                        updateData.mb_type = sendData.mb_type;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_task_1") {
                        updateData.mb_task_1 = sendData.mb_task_1;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_task_2") {
                        updateData.mb_task_2 = sendData.mb_task_2;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_task_3") {
                        updateData.mb_task_3 = sendData.mb_task_3;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_task_4") {
                        updateData.mb_task_4 = sendData.mb_task_4;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_image") {
                        updateData.mb_image = sendData.mb_image;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_x") {
                        updateData.mb_x = sendData.mb_x;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_y") {
                        updateData.mb_imamb_ye = sendData.mb_y;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_scale") {
                        updateData.mb_scale = sendData.mb_scale;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_code_device") {
                        updateData.mb_imamb_code_devicee = sendData.mb_code_device;
                        break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_work_state") {
                          updateData.mb_work_state = sendData.mb_work_state;
                          break;
                      }
                      else if (sendData.batchSaveColumnName[i] == "mb_etc") {
                        updateData.mb_etc = sendData.mb_etc;
                        break;
                      }
                    }

                    cursor.update(updateData);
                    
                    cursor.continue();
                  } else {
                     setTimeout(function() {
                      location.reload(true);
                    }, 2000);
                      messagebox_show(false, "데이터 저장", "사용자 정보가 수정되었습니다.", null, false, true);
                    }
                  }
              });
              
              // //JSON
              // var url = url_json + "jsonservice/rfms/update_userinfo_batch";      //batch update              
              // JSON_POST(url, sendData, false, sessionStorage.getItem(token_yj_rfms), function (result) {
              //   if (result[0] == "ok") {
              //     messagebox_show(false, "데이터 저장", result, null, false, true);
                  
              //     setTimeout(function() {
              //       location.reload(true);
              //     }, 2000);
              //     // //데이터 추가, 수정
              //     //   //gui 수정
              //     //   for (var k = 0; k < app_dialog.table.rows().count(); k++) {
              //     //     if (sendData.no == app_dialog.table.rows(k).data()[0].no) {
              //     //       //app_dialog.table.row(k).data() = sendData;
              //     //       app_dialog.table.row(k).data(sendData);

              //     //       //순차적 인덱스가 삭제되므로 다시 그려줌
              //     //       app_dialog.table.column(app_dialog.index_id_position, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
              //     //         cell.innerHTML = i + 1;
              //     //       });
              //     //     }
              //     //   }

              //     //   //dataSet 수정
              //     //   for (var k = 0; k < app_dialog.dataSet.length; k++) {
              //     //     if (sendData.no == app_dialog.dataSet[k].no) {
              //     //       app_dialog.dataSet[k] = sendData;
              //     //     }
              //     //   }
                  
                  
              //   } else {
              //     messagebox_show(false, "데이터 저장 실패", result, null, false, true);
              //   }
              // });
            });
          }
        }, false, true);
      } else {
        send_userinfo(false);      
      }
      //메시지박스 출력
      //messagebox_show(false, "데이터 저장", "저장되었습니다.", null, false, true);
      //dialog_close();
    });

    //창 닫기 (종료버튼)
    document.getElementById('btnCancel_dialog_users').addEventListener('click', function() {
      dialog_close();
    });

    document.getElementById('dialog-close-id_dialog_users').addEventListener('click', function() {
      dialog_close();
    });

    document.getElementById('dialog-close-id_dialog_users').addEventListener('mouseover', function() {
      var closeButton = document.getElementById('dialog-close-id_dialog_users');
      closeButton.src = "/images/close4.png";
    });

    document.getElementById('dialog-close-id_dialog_users').addEventListener('mouseleave', function() {
      var closeButton = document.getElementById('dialog-close-id_dialog_users');
      closeButton.src = "/images/close2.png";
    });

    //윈도우 닫기 아이콘
    window.addEventListener("keydown", function(e){
      if (e.keyCode == 27) {                    //esc
        if (check_dialog_visible("dialog_messagebox") == true) {
          messagebox_close();                   //dialog_messagebox.html 페이지 함수
        } else if (check_dialog_visible("dialog_password_change") == true) {
          dialog_password_change_close();       //dialog_password_change.html 페이지 함수
        } else if (check_dialog_visible("dialog_container_pop") == true) {
          if (document.getElementById("dialog_auth_pop") != null) {
            dialog_close_auth_pop();       //dialog_password_change.html 페이지 함수
          }
          if (document.getElementById("dialog_dept_pop") != null) {
            dialog_close_dept_pop();       //dialog_password_change.html 페이지 함수
          }
          if (document.getElementById("dialog_position_pop") != null) {
            dialog_close_position_pop();       //dialog_password_change.html 페이지 함수
          }
          if (document.getElementById("dialog_statususer_pop") != null) {
            dialog_close_statususer_pop();       //dialog_password_change.html 페이지 함수
          }
        } else {
          dialog_close();
        }
      }
    });


    function change_top_margin_users() {
      //모바일일 경우 다이어로그 top 변경
      if (matchMedia("screen and (max-width:480px)").matches) {           //스마트폰이 세로인 경우
        $("#dialog_container_main .dialog").css("marginTop", "550px");
      } else {
        $("#dialog_container_main .dialog").css("marginTop", "20px");
      }
      
      if (matchMedia("screen and (max-height:480px)").matches) {          //스마트폰을 가로로 눕힌 경우
        $("#dialog_container_main .dialog").css("marginTop", "550px");
      }
    }

    function dialog_close(){
      //var app = document.querySelector('.dialog-container');
      var dialog_container_main = document.getElementById("dialog_container_main");
      if (dialog_container_main != null) {
        dialog_container_main.classList.remove('dialog-container--visible');                

        //body scoll on
        scroll_body_on_off(true);

        $('#dialog_write_position').css('pointer-events','none');
      }
    }
      
    function send_userinfo(isAdd) {
      //정보 추가일 경우 중복 확인 필수
      // if (isAdd) {
      //   if (sendRead_checkID == false) {
      //     messagebox_show(false, "아이디 중복 확인", "아이디 중복 확인을 하셔야 합니다.", null, false, true);
      //     return;
      //   }
      // }

      //파일 가져오기
      var getImageFile = document.getElementById("dialog_write_image").files[0];
      // if (getImageFile == undefined) {
      //   messagebox_show(false, "이미지 선택", null, null, false, true);
      // }

      //수정일 경우 등록일자 변경하지 않기
      var regist_datetime = currentDateTime();
      if (isAdd == false) {
        regist_datetime = document.getElementById("dialog_write_regist_datetime").value;
      }
      
      //셀렉트 박스
      var mb_auth_value = "";
      if (document.getElementById("dialog_write_auth").selectedIndex > -1) {
        mb_auth_value = document.getElementById("dialog_write_auth").options[document.getElementById("dialog_write_auth").selectedIndex].text;
      }

      var mb_dept_value = "";
      if (document.getElementById("dialog_write_dept").selectedIndex > -1) {
        mb_dept_value = document.getElementById("dialog_write_dept").options[document.getElementById("dialog_write_dept").selectedIndex].text;
      }

      var mb_position_value = "";
      if (document.getElementById("dialog_write_position").selectedIndex > -1) {
        mb_position_value = document.getElementById("dialog_write_position").options[document.getElementById("dialog_write_position").selectedIndex].text;
      }

      var mb_statususer_value = "";
      if (document.getElementById("dialog_write_statususer").selectedIndex > -1) {
        var getClassName = document.getElementById("dialog_write_statususer").options[document.getElementById("dialog_write_statususer").selectedIndex].text;
        for (var i = 0; i<list_statususerinfo.length; i++){
          if (list_statususerinfo[i].su_name == getClassName) {
            mb_statususer_value = list_statususerinfo[i].su_pagename;
          }
        }
      }

      var mb_type_value = "";
      if (document.getElementById("dialog_write_type").selectedIndex > -1) {
        mb_type_value = document.getElementById("dialog_write_type").options[document.getElementById("dialog_write_type").selectedIndex].text;
      }

      var mb_scale_value = "";
      if (document.getElementById("dialog_write_scale").selectedIndex > -1) {
        mb_scale_value = document.getElementById("dialog_write_scale").options[document.getElementById("dialog_write_scale").selectedIndex].text;
      }
        
      

      FileToBase64(getImageFile, function(result_image) {
        var sendData = {
          no: parseInt(document.getElementById("dialog_write_no").value) || 0,
          select: false,
          mb_id: document.getElementById("dialog_write_user_id").value,
          mb_password: document.getElementById("dialog_write_password").value,
          mb_name: document.getElementById("dialog_write_name").value,
          mb_email: document.getElementById("dialog_write_email").value,
          mb_tel: "",
          mb_mobile: document.getElementById("dialog_write_mobile").value,
          mb_sex: true,
          mb_addr_1: "",
          mb_addr_2: "",
          mb_addr_3: "",
          mb_post: "",
          // mb_regist_datetime: "2019-04-20 12:11:11",
          // mb_out_datetime: "2018-12-20 14:11:11",
          mb_regist_datetime: regist_datetime,
          mb_lastsave_datetime: currentDateTime(),
          mb_out_datetime: null,
          mb_userinfo_delete: 1,
          mb_license: 1,
          mb_license_date: document.getElementById("dialog_write_license_date").value,
          //mb_license_date: "2018-12-28",
          //mb_license_date: currentDate(),
          mb_sns: "",
          mb_auth: mb_auth_value,
          mb_dept: mb_dept_value,
          mb_position: mb_position_value,
          mb_statususer: mb_statususer_value,
          mb_type: mb_type_value,
          mb_task_1: document.getElementById("dialog_write_task_1").value,
          mb_task_2: document.getElementById("dialog_write_task_2").value,
          mb_task_3: document.getElementById("dialog_write_task_3").value,
          mb_task_4: document.getElementById("dialog_write_task_4").value,
          mb_x: document.getElementById("dialog_write_x").value,
          mb_y: document.getElementById("dialog_write_y").value,
          mb_scale: document.getElementById("dialog_write_scale").value,
          mb_code_device: document.getElementById("dialog_write_code_device").value,
          //mb_image: "",                    
          mb_image: result_image,
          mb_etc: "",
        }

        // if (sendData.mb_id.trim() == "") {
        //   messagebox_show(false, "데이터 입력", "아이디를 입력하여 주시기 바랍니다.", null, false, true);
        //   sendRead_checkID = false;
        //   return;
        // }

        // if (sendData.mb_password == "") {
        //   messagebox_show(false, "데이터 입력", "비밀번호를 입력하여 주시기 바랍니다.", null, false, true);
        //   return;
        // }

        //indexed db create, edit
        indexedDB_open(function(e) {
          var transaction = e.transaction(["yj_member"], "readwrite");
          var store = transaction.objectStore("yj_member");
          var request;

          
          if (isAdd) {
            request = store.add(sendData);
          } else {
            request = store.get(sendData.no);
          }

          request.onerror = function(e) {
              //  console.log("Error",e.target.error.name);                         
          }
          
          request.onsuccess = function(e) {                        
            //데이터 추가, 수정
            if (isAdd) {
              sendData.no = parseInt(e.target.result) || 0;                    //서버로부터 반환된 자동증가번호 저장 (고유번호: no)
              app_dialog.table.row.add(sendData).draw(false);   //gui 추가
              app_dialog.dataSet.push(sendData);                //dataSet 추가

              messagebox_show(false, "데이터 저장", "사용자 정보가 추가되었습니다.", null, false, true);
            } else {
              //db update
              var data = e.target.result;
              
              data.mb_id = sendData.mb_id;
              data.mb_name = sendData.mb_name;
              data.mb_email = sendData.mb_email;
              data.mb_mobile = sendData.mb_mobile;
              data.mb_sex = sendData.mb_sex;
              data.mb_addr_1 = sendData.mb_addr_1;
              data.mb_addr_2 = sendData.mb_addr_2;
              data.mb_addr_3 = sendData.mb_addr_3;
              data.mb_post = sendData.mb_post;
              data.mb_regist_datetime = sendData.mb_regist_datetime;
              data.mb_lastsave_datetime = sendData.mb_lastsave_datetime;
              data.mb_out_datetime = sendData.mb_out_datetime;
              data.mb_userinfo_delete = sendData.mb_userinfo_delete;
              data.mb_license = sendData.mb_license;
              data.mb_license_date = sendData.mb_license_date;
              data.mb_sns = sendData.mb_sns;
              data.mb_dept = sendData.mb_dept;
              data.mb_position = sendData.mb_position;
              data.mb_statususer = sendData.mb_statususer;
              data.mb_type = sendData.mb_type;
              data.mb_task_1 = sendData.mb_task_1;
              data.mb_task_2 = sendData.mb_task_2;
              data.mb_task_3 = sendData.mb_task_3;
              data.mb_task_4 = sendData.mb_task_4;

              if (document.getElementById("dialog_write_image").files[0] != null) {
                data.mb_image = sendData.mb_image;
              }

              if (data.mb_image != null) {
                sendData.mb_image = data.mb_image;
              }
              
              data.mb_x = sendData.mb_x;
              data.mb_y = sendData.mb_y;
              data.mb_scale = sendData.mb_scale;
              data.mb_code_device = sendData.mb_code_device;
              data.mb_work_state = sendData.mb_work_state;
              data.mb_etc = sendData.mb_etc;

              var objRequest = store.put(data);
      
              //gui 수정
              for (var k = 0; k < app_dialog.table.rows().count(); k++) {
                if (sendData.no == app_dialog.table.rows(k).data()[0].no) {
                  //app_dialog.table.row(k).data() = sendData;
                  app_dialog.table.row(k).data(sendData);

                  //순차적 인덱스가 삭제되므로 다시 그려줌
                  app_dialog.table.column(app_dialog.index_id_position, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
                    cell.innerHTML = i + 1;
                  });
                }
              }

              //dataSet 수정
              for (var k = 0; k < app_dialog.dataSet.length; k++) {
                if (sendData.no == app_dialog.dataSet[k].no) {
                  app_dialog.dataSet[k] = sendData;
                }
              }

              messagebox_show(false, "데이터 저장", "사용자 정보가 수정되었습니다.", null, false, true);
            }
          }
        });

        // //JSON
        // var url = url_json + "jsonservice/rfms/update_userinfo";      //insert / update 선택
        // if (isAdd) {
        //   url = url_json + "jsonservice/rfms/insert_userinfo";
        // }
        // //var url = "http://127.0.0.1:31419/jsonservice/rfms/insert_userinfo";
        // JSON_POST(url, sendData, false, sessionStorage.getItem(token_yj_rfms), function (result) {
        //   if (result[0] == "ok") {
        //     messagebox_show(false, "데이터 저장", result, null, false, true);
            
        //     //데이터 추가, 수정
        //     if (isAdd) {
        //       sendData.no = result[2];                          //서버로부터 반환된 자동증가번호 저장 (고유번호: no)
        //       app_dialog.table.row.add(sendData).draw(false);   //gui 추가
        //       app_dialog.dataSet.push(sendData);                //dataSet 추가
        //     } else {
        //       //gui 수정
        //       for (var k = 0; k < app_dialog.table.rows().count(); k++) {
        //         if (sendData.no == app_dialog.table.rows(k).data()[0].no) {
        //           //app_dialog.table.row(k).data() = sendData;
        //           app_dialog.table.row(k).data(sendData);

        //           //순차적 인덱스가 삭제되므로 다시 그려줌
        //           app_dialog.table.column(app_dialog.index_id_position, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
        //             cell.innerHTML = i + 1;
        //           });
        //         }
        //       }

        //       //dataSet 수정
        //       for (var k = 0; k < app_dialog.dataSet.length; k++) {
        //         if (sendData.no == app_dialog.dataSet[k].no) {
        //           app_dialog.dataSet[k] = sendData;
        //         }
        //       }
        //     }
        //   } else {
        //     messagebox_show(false, "데이터 저장 실패", result, null, false, true);
        //   }
        // });


      });
    }

    

    function send_checkUser(rValue) {
        var sendData = document.getElementById("dialog_write_user_id").value;
        //JSON
        var url = url_json + "jsonservice/rfms/check_user";
        JSON_POST(url, sendData, false, sessionStorage.getItem(token_yj_rfms), function(result) {
          rValue(result);
        });
    }

    //input text가 변경될 경우 배경색을 변경
    function setInput_backgroundColor(input_name) {
      var get_dialog = document.getElementById(input_name);
      
      if (get_dialog == null)
        return;

      if ((get_dialog.value == null) || (get_dialog.value == '')) {
        get_dialog.style.backgroundColor = "#ddd";
      } else {
        get_dialog.style.backgroundColor = "#fff";
        return input_name;
      }      
    }

    function setInput_backgroundColor_darkAll() {
      document.getElementById('dialog_write_user_id').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_password').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_name').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_email').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_mobile').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_no').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_regist_datetime').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_lastsave_datetime').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_license_date').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_auth').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_dept').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_position').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_statususer').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_x').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_y').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_scale').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_code_device').style.backgroundColor = "#ddd";
      document.getElementById('print_selected_imagename').style.backgroundColor = "#ddd";
      document.getElementById('dialog_write_image').style.backgroundColor = "#ddd";

      check_inputdata();
    }

    //input text가 존재한다면 배경색을 변경
    function check_inputdata() {
      var getValue = new Array();
      var rValue = new Array();
      var i = 0;
      // if (setInput_backgroundColor('dialog_write_user_id') != null) 
      //   rValue[i++] = 

      getValue[i++] = setInput_backgroundColor('dialog_write_user_id');
      getValue[i++] = setInput_backgroundColor('dialog_write_password');
      getValue[i++] = setInput_backgroundColor('dialog_write_name');
      getValue[i++] = setInput_backgroundColor('dialog_write_email');
      getValue[i++] = setInput_backgroundColor('dialog_write_mobile');
      getValue[i++] = setInput_backgroundColor('dialog_write_no');
      getValue[i++] = setInput_backgroundColor('dialog_write_regist_datetime');
      getValue[i++] = setInput_backgroundColor('dialog_write_lastsave_datetime');
      getValue[i++] = setInput_backgroundColor('dialog_write_license_date');
      getValue[i++] = setInput_backgroundColor('dialog_write_auth');
      getValue[i++] = setInput_backgroundColor('dialog_write_dept');
      getValue[i++] = setInput_backgroundColor('dialog_write_position');
      getValue[i++] = setInput_backgroundColor('dialog_write_statususer');
      getValue[i++] = setInput_backgroundColor('dialog_write_x');
      getValue[i++] = setInput_backgroundColor('dialog_write_y');
      getValue[i++] = setInput_backgroundColor('dialog_write_scale');
      getValue[i++] = setInput_backgroundColor('dialog_write_code_device');
      getValue[i++] = setInput_backgroundColor('print_selected_imagename');
      getValue[i++] = setInput_backgroundColor('dialog_write_image');

      //값이 존재하는 db컬럼명 반환
      var j = 0;
      for (var k = 0; k < getValue.length; k ++) {
        if (IsNullOrWhiteSpace(getValue[k]) == false) {          
          var getColumnName = convertColumnName(getValue[k]);
          if (IsNullOrWhiteSpace(getColumnName) == false) {
            rValue[j++] = getColumnName;
          }          
        }
      }

      //마지막 저장일자 저장
      rValue[j++] = "mb_lastsave_datetime";

      return rValue;
    }

    function convertColumnName(input_name) {
      if (IsNullOrWhiteSpace(input_name) == true) {
        return null;
      }

      var rValue = "";
      switch (input_name) {
        case "dialog_write_name":
          rValue = "mb_name";
          break;
        case "dialog_write_email":
          rValue = "mb_email";
          break;
        case "dialog_write_mobile":
          rValue = "mb_mobile";
          break;
        case "dialog_write_license_date":
          rValue = "mb_license_date";
          break;
        case "dialog_write_auth":
          rValue = "mb_auth";
          break;
        case "dialog_write_dept":
          rValue = "mb_dept";
          break;
        case "dialog_write_position":
          rValue = "mb_position";
          break;
        case "dialog_write_statususer":
          rValue = "mb_statususer";
          break;
        case "dialog_write_type":
          rValue = "mb_type";
          break;
        case "dialog_write_task_1":
          rValue = "mb_task_1";
          break;
        case "dialog_write_task_2":
          rValue = "mb_task_2";
          break;
        case "dialog_write_task_3":
          rValue = "mb_task_3";
          break;
        case "dialog_write_task_4":
          rValue = "mb_task_4";
          break;
        case "dialog_write_x":
          rValue = "mb_x";
          break;
        case "dialog_write_y":
          rValue = "mb_y";
          break;
        case "dialog_write_scale":
          rValue = "mb_scale";
          break;
        case "dialog_write_code_device":
          rValue = "mb_code_device";
          break;
        case "dialog_write_image":
          rValue = "mb_image";        
          break;
      }

      return rValue;
    }

    //일괄 수정시 inputbox에 데이터를 입력할 경우 배경색상 변경
    function setInput_event(objectName) {
      document.getElementById(objectName).addEventListener('input', function(e) {
        if ((e.inputType != "deleteContentBackward") &&
            (e.inputType != "deleteContentForward"))
         {   //backspace, delete가 아닐 경우 배경색 변경 체크
          setInput_backgroundColor(objectName);
        }        
      });
      document.getElementById(objectName).addEventListener('click', function(e) {
        if (document.getElementById('dialog-title1-dialog_container_main').textContent == "사용자 정보 일괄 수정") {
          setInput_backgroundColor_darkAll();
          this.style.backgroundColor = "#fff";
        }
      });
    }
    ////////////////////////////
    //GUI 일괄 수정 기능
    ////////////////////////////
    
    //일괄 수정시 inputbox에 데이터를 입력할 경우 배경색상 변경
    setInput_event('dialog_write_name');
    setInput_event('dialog_write_email');
    setInput_event('dialog_write_mobile');
    setInput_event('dialog_write_license_date');    
    setInput_event('dialog_write_auth');
    setInput_event('dialog_write_dept');
    setInput_event('dialog_write_position');
    setInput_event('dialog_write_statususer');
    setInput_event('dialog_write_x');
    setInput_event('dialog_write_y');
    setInput_event('dialog_write_scale');
    setInput_event('dialog_write_code_device');
    setInput_event('print_selected_imagename');
    setInput_event('dialog_write_image');
  });
  

  function selectDept() {
    var list_deptinfo = new Array();

    //indexed db select
    indexedDB_open(function(e) {
      var transaction = e.transaction(["yj_dept"], "readwrite");
      var store = transaction.objectStore("yj_dept");

      store.openCursor().onsuccess = function(event) {
        var cursor = event.target.result;
        if (cursor) {
            var deptinfo = {
                no: cursor.value.de_no,
                select: false,
                de_name: cursor.value.de_name,
                de_regist_datetime: cursor.value.de_regist_datetime,
                de_lastsave_datetime: cursor.value.de_lastsave_datetime,
                de_lastsave_datetime: cursor.value.de_lastsave_datetime,
                de_image: cursor.value.de_image,
                de_etc: cursor.value.de_etc,
            };
            list_deptinfo.push(deptinfo);

            cursor.continue();
        } else {
          var selectElement = document.getElementById('dialog_write_dept');
          for (var i = 0; i<list_deptinfo.length; i++){
            var opt = document.createElement('option');
              opt.value = i + 1;
              opt.innerHTML = list_deptinfo[i].de_name;
              selectElement.appendChild(opt);
          }
        }
      };
    });

  }

  // function selectDept() {
  //   var url = url_json + "jsonservice/dept/select_deptinfo_all";  
  //     JSON_POST(url, null, true, sessionStorage.getItem(token_yj_rfms), function (result) {
  //         setTimeout(function() {
  //             //json 데이터 수신 후 옵션 항목 추가
  //             if (result[0] == "ok") {                
  //               var selectElement = document.getElementById('dialog_write_dept');
  //                 for (var i = 0; i<result[1].length; i++){
  //                   var opt = document.createElement('option');
  //                     opt.value = i + 1;
  //                     opt.innerHTML = result[1][i].de_name;
  //                     selectElement.appendChild(opt);
  //                 }
  //                 //selectElement.selectedIndex = 0;    //인덱스는 다이어로그가 보이는 시점에서 재설정 됨 (window.addEventListener('message', function(event) { 함수 확인)
  //                 //document.getElementById("dialog_write_dept").selectedIndex = "0";
  //             } else {                                
  //                 messagebox_show(false, "데이터 가져오기 실패", result, null, false, true);
  //             }
  //         }, 0);                                                                                    //지연시켜서 메시지박스를 호출하지 않으면 메시지 박스 내용(텍스트)가 변경되지 않음 
  //     });
  // }

  function selectAuth() {
    //indexed db select all
    var list_authinfo = new Array();

    indexedDB_open(function(e) {
      var transaction = e.transaction(["yj_auth"], "readwrite");
      var store = transaction.objectStore("yj_auth");

      store.openCursor().onsuccess = function(event) {
          var cursor = event.target.result;
          if (cursor) {
              var authinfo = {
                  no: cursor.key,
                  select: false,
                  au_name: cursor.value.au_name,
                  au_regist_datetime: cursor.value.au_regist_datetime,
                  au_lastsave_datetime: cursor.value.au_lastsave_datetime,
                  au_image: cursor.value.au_image,
                  au_etc: cursor.value.au_etc,
              };
              list_authinfo.push(authinfo);

              cursor.continue();
          } else {
            var selectElement = document.getElementById('dialog_write_auth');
            for (var i = 0; i<list_authinfo.length; i++){
              var opt = document.createElement('option');
                opt.value = i + 1;
                opt.innerHTML = list_authinfo[i].au_name;
                selectElement.appendChild(opt);
            }
          }
        };
    });
  }
  // function selectAuth() {
  //   var url = url_json + "jsonservice/auth/select_authinfo_all";
  //     JSON_POST(url, null, true, sessionStorage.getItem(token_yj_rfms), function (result) {
  //         setTimeout(function() {            
  //             //json 데이터 수신 후 옵션 항목 추가
  //             if (result[0] == "ok") {
  //               var selectElement = document.getElementById('dialog_write_auth');
  //               for (var i = 0; i<result[1].length; i++){
  //                 var opt = document.createElement('option');
  //                   opt.value = i + 1;
  //                   opt.innerHTML = result[1][i].au_name;
  //                   selectElement.appendChild(opt);
  //               }
                
  //               //selectElement.selectedIndex = 0;    //인덱스는 다이어로그가 보이는 시점에서 재설정 됨 (window.addEventListener('message', function(event) { 함수 확인)
  //             } else {                                
  //                 messagebox_show(false, "데이터 가져오기 실패", result, null, false, true);
  //             }
  //         }, 0);                                                                                    //지연시켜서 메시지박스를 호출하지 않으면 메시지 박스 내용(텍스트)가 변경되지 않음 
  //     });
  // }

  // function selectPosition() {
  //   var url = url_json + "jsonservice/position/select_positioninfo_all";
  //     JSON_POST(url, null, true, sessionStorage.getItem(token_yj_rfms), function (result) {
  //         setTimeout(function() {            
  //             //json 데이터 수신 후 옵션 항목 추가
  //             if (result[0] == "ok") {
  //               var selectElement = document.getElementById('dialog_write_position');
  //               for (var i = 0; i<result[1].length; i++){
  //                 var opt = document.createElement('option');
  //                   opt.value = i + 1;
  //                   opt.innerHTML = result[1][i].po_name;
  //                   selectElement.appendChild(opt);
  //               }
                
  //               //selectElement.selectedIndex = 0;    //인덱스는 다이어로그가 보이는 시점에서 재설정 됨 (window.addEventListener('message', function(event) { 함수 확인)
  //             } else {                                
  //                 messagebox_show(false, "데이터 가져오기 실패", result, null, false, true);
  //             }
  //         }, 0);                                                                                    //지연시켜서 메시지박스를 호출하지 않으면 메시지 박스 내용(텍스트)가 변경되지 않음 
  //     });
  // }

  function selectPosition(get_selected_userinfo, isInit) {
    //indexed db select all
    var list_positioninfo = new Array();
    
    indexedDB_open(function(e) {
        var transaction = e.transaction(["yj_position"], "readwrite");
        var store = transaction.objectStore("yj_position");

        store.openCursor().onsuccess = function(event) {
            var cursor = event.target.result;
            if (cursor) {
                var positioninfo = {
                    no: cursor.key,
                    select: false,
                    po_name: cursor.value.po_name,
                    po_regist_datetime: cursor.value.po_regist_datetime,
                    po_lastsave_datetime: cursor.value.po_lastsave_datetime,
                    po_image: cursor.value.po_image,
                    po_etc: cursor.value.po_etc,
                };
                list_positioninfo.push(positioninfo);

                cursor.continue();
            } else {
                //GUI 적용
                $('#dialog_write_position').empty()
                var selectElement = document.getElementById('dialog_write_position');
                for (var i = 0; i<list_positioninfo.length; i++){
                    //셀렉트 리스트 추가
                    var opt = document.createElement('option');
                    opt.value = i + 1;
                    opt.innerHTML = list_positioninfo[i].po_name;
                    selectElement.appendChild(opt);

                    //아이템 선택
                    if (get_selected_userinfo != null) {
                        if (list_positioninfo[i].po_name == get_selected_userinfo.mb_position) {
                            selectElement.selectedIndex = i;
                        }
                    }
                    

                    // //관리자 권한일경우
                    // if ((get_selected_userinfo.mb_auth == "관리자") || (get_selected_userinfo.mb_auth == "시스템관리자")) {
                    //     opt.disabled = true;
                    // }
                }

                //select element 클릭 안되게 
                if (get_selected_userinfo != null) {
                    $('#dialog_write_position').css('pointer-events','none');
                } else {
                    $('#dialog_write_position').css('pointer-events','auto');
                }
                
                if (isInit) {
                  $('#dialog_write_position').css('pointer-events','none');
                }
            }
         };
    });
  }


  function selectStatususer() {
    //indexed db select all
    var list_statususerinfo = new Array();

    indexedDB_open(function(e) {
      var transaction = e.transaction(["yj_statususer"], "readwrite");
      var store = transaction.objectStore("yj_statususer");

      store.openCursor().onsuccess = function(event) {
          var cursor = event.target.result;
          if (cursor) {
              var statususerinfo = {
                  no: cursor.key,
                  select: false,
                  su_name: cursor.value.su_name,
                  su_view: cursor.value.su_view,
                  su_pagename: cursor.value.su_pagename,
                  su_regist_datetime: cursor.value.su_regist_datetime,
                  su_lastsave_datetime: cursor.value.su_lastsave_datetime,
                  su_image: cursor.value.su_image,
                  su_etc: cursor.value.su_etc,
              };
              list_statususerinfo.push(statususerinfo);

              cursor.continue();
          } else {
            var selectElement = document.getElementById('dialog_write_statususer');
            for (var i = 0; i<list_statususerinfo.length; i++){
              var opt = document.createElement('option');
                opt.value = i + 1;
                opt.innerHTML = list_statususerinfo[i].su_name;
                selectElement.appendChild(opt);
            }
          }
      };
    });
  }

  // function selectStatususer() {
  //   var url = url_json + "jsonservice/statususer/select_statususerinfo_all";
  //     JSON_POST(url, null, true, sessionStorage.getItem(token_yj_rfms), function (result) {
  //         setTimeout(function() {            
  //             //json 데이터 수신 후 옵션 항목 추가
  //             if (result[0] == "ok") {
  //               var selectElement = document.getElementById('dialog_write_statususer');
  //               for (var i = 0; i<result[1].length; i++){
  //                 var opt = document.createElement('option');
  //                   opt.value = i + 1;
  //                   opt.innerHTML = result[1][i].su_name;
  //                   selectElement.appendChild(opt);
  //               }
                
  //               //selectElement.selectedIndex = 0;    //인덱스는 다이어로그가 보이는 시점에서 재설정 됨 (window.addEventListener('message', function(event) { 함수 확인)
  //             } else {                                
  //                 messagebox_show(false, "데이터 가져오기 실패", result, null, false, true);
  //             }
  //         }, 0);                                                                                    //지연시켜서 메시지박스를 호출하지 않으면 메시지 박스 내용(텍스트)가 변경되지 않음 
  //     });
  // }
</script>









<!-- // Sending and receiving data in JSON format using POST method
//
var xhr = new XMLHttpRequest();
var url = "url";
xhr.open("POST", url, true);
xhr.setRequestHeader("Content-Type", "application/json");
xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 && xhr.status === 200) {
        var json = JSON.parse(xhr.responseText);
        console.log(json.email + ", " + json.password);
    }
};
var data = JSON.stringify({"email": "hey@mail.com", "password": "101010"});
xhr.send(data);



// Sending a receiving data in JSON format using GET method
//      
var xhr = new XMLHttpRequest();
var url = "url?data=" + encodeURIComponent(JSON.stringify({"email": "hey@mail.com", "password": "101010"}));
xhr.open("GET", url, true);
xhr.setRequestHeader("Content-Type", "application/json");
xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 && xhr.status === 200) {
        var json = JSON.parse(xhr.responseText);
        console.log(json.email + ", " + json.password);
    }
};
xhr.send();



<?php
// Handling data in JSON format on the server-side using PHP
//
header("Content-Type: application/json");
// build a PHP variable from JSON sent using POST method
$v = json_decode(stripslashes(file_get_contents("php://input")));
// build a PHP variable from JSON sent using GET method
$v = json_decode(stripslashes($_GET["data"]));
// encode the PHP variable to JSON and send it back on client-side
echo json_encode($v);
?> -->